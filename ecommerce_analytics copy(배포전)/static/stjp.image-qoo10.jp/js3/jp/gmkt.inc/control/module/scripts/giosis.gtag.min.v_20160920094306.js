// (c)2013 Giosis Group

var gtag=new function(){this.mode="";this.id="";this.max_width=0;this.max_height=0;this.max_left=0;this.max_top=0;this.width=0;this.height=0;this.margin_left=0;this.margin_top=0;this.limit_tag_cnt=1;this.album_id=0;this.album_img="";this.tag_locate_limit=30;this.t_cur_tag_no="";};gtag.init=function(id){gtag.id=id;gtag.reset();}
gtag.reset=function(obj_id){if(obj_id!=undefined&&obj_id!=null&&obj_id!=""){gtag.id=obj_id;gtag.mode=$("#"+gtag.id+"_obj_info").attr("mode");gtag.max_width=parseInt($("#"+gtag.id+"_obj_info").attr("max_width"));gtag.max_height=parseInt($("#"+gtag.id+"_obj_info").attr("max_height"));gtag.limit_tag_cnt=parseInt($("#"+gtag.id+"_obj_info").attr("limit_tag_cnt"));gtag.width=parseInt($("#"+gtag.id+"_obj_info").attr("width"));gtag.height=parseInt($("#"+gtag.id+"_obj_info").attr("height"));gtag.max_left=parseInt($("#"+gtag.id+"_obj_info").attr("max_left"));gtag.max_top=parseInt($("#"+gtag.id+"_obj_info").attr("max_top"));gtag.margin_left=parseInt($("#"+gtag.id+"_obj_info").attr("margin_left"));gtag.margin_top=parseInt($("#"+gtag.id+"_obj_info").attr("margin_top"));gtag.album_id=$("#"+gtag.id+"_obj_info").attr("album_id");gtag.album_img=$("#"+gtag.id+"_obj_info").attr("album_img");}else{$("#"+gtag.id).html("");gtag.mode="";gtag.max_width=0;gtag.max_height=0;gtag.limit_tag_cnt=1;gtag.width=0;gtag.height=0;gtag.max_left=0;gtag.max_top=0;gtag.margin_left=0;gtag.margin_top=0;gtag.album_id="N";gtag.album_img="N";}}
gtag.render=function(mode,id,max_width,max_height,img_url,limit_tag_cnt,img_log_no,comment,album_id,album_img){gtag.init(id);gtag.max_width=max_width;gtag.max_height=max_height;gtag.limit_tag_cnt=limit_tag_cnt;gtag.album_id=(album_id!=undefined?album_id:0);gtag.album_img=(album_img!=undefined?album_img:"");var resize_img_url=(img_url!=""?Public.GetDPImagePath(img_url,max_width):"");var tag_html_str="";if(mode=="SS"){tag_html_str+='<div class="sldshw_img" id="'+gtag.id+'_plat_div">';tag_html_str+=' <div class="img" id="'+gtag.id+'_plat_img" onclick="gtag.pointAddTag(event, \''+gtag.id+'\');"><img src="'+Public.GetLoadingImage(max_width)+'" gd_src="'+resize_img_url+'" load="N" resizing="470, 350"></div>';tag_html_str+=' <input type="hidden" id="'+gtag.id+'_obj_info" mode="'+mode+'" max_width="'+max_width+'" max_height="'+max_height+'" limit_tag_cnt="'+limit_tag_cnt+'" album_id="'+gtag.album_id+'" album_img="'+gtag.album_img+'" />';tag_html_str+=' <input type="hidden" id="'+gtag.id+'_img_log_no" value="'+(img_log_no!=undefined&&img_log_no!=""?img_log_no:"")+'"/>';tag_html_str+='</div>';tag_html_str+='<div class="sldshw_tag">';tag_html_str+=' <div class="sldshw_tag_inf">';tag_html_str+='  <p class="bt_tag" onclick="gtag.addTag(\''+gtag.id+'\'); return false;" title="'+MultiLang.findCommonResource("Control/Module/TagControl.ascx","gtag_Tag_Item_PC")+'" style="font-size: 15px;cursor: pointer;">'+MultiLang.findCommonResource("Control/Module/TagControl.ascx","gtag_Tag_Item_PC")+'</p>';tag_html_str+='  <span class="num" id="'+gtag.id+'_tag_cnt" style="display:none;"></span>';tag_html_str+=' </div>';tag_html_str+=' <ul class="sldshw_tag_lst" id="'+gtag.id+'_tag_info"></div>';tag_html_str+='</div>';}else{tag_html_str+='<div class="shpkw_img" id="'+gtag.id+'_plat_div" style="height:'+max_height+'px;">';tag_html_str+=' <div class="img" id="'+gtag.id+'_plat_img" onclick="gtag.pointAddTag(event, \''+gtag.id+'\');"><img src="'+resize_img_url+'" alt="" onload="gtag.imageLoad(\''+gtag.id+'\',\''+resize_img_url+'\'); return false;" /></div>';tag_html_str+=' <input type="hidden" id="'+gtag.id+'_obj_info" mode="'+mode+'" max_width="'+max_width+'" max_height="'+max_height+'" limit_tag_cnt="'+limit_tag_cnt+'" album_id="'+gtag.album_id+'" album_img="'+gtag.album_img+'" />';tag_html_str+=' <input type="hidden" id="'+gtag.id+'_img_log_no" value="'+(img_log_no!=undefined&&img_log_no!=""?img_log_no:"")+'"/>';tag_html_str+='</div>';tag_html_str+='<p class="shpkw_tag_inf">'+MultiLang.findCommonResource("Control/Module/TagControl.ascx","gtag_Tag_Notice")+'</p>';tag_html_str+='<div class="shpkw_cpt">';tag_html_str+=' <label class="hide" for="'+gtag.id+'_tag_comment">'+MultiLang.findCommonResource("Control/Module/TagControl.ascx","gtag_Caption")+'</label>';tag_html_str+=' <textarea class="ip_txt" maxlength="1000" cols="12" id="'+gtag.id+'_tag_comment" rows="3" name="'+gtag.id+'_tag_comment" placeholder="'+(mode=="PC"?MultiLang.findCommonResource("Control/Module/TagControl.ascx","gtag_Caption_PlaceHolder_Notice_PC"):MultiLang.findCommonResource("Control/Module/TagControl.ascx","gtag_Caption_PlaceHolder_Notice"))+'">'+(comment!=undefined&&comment!=""?comment:"")+'</textarea>';tag_html_str+='</div>';tag_html_str+='<div class="shpkw_tag">';if(mode=="PC"){tag_html_str+=' <div class="shpkw_tag_inf">';tag_html_str+='  <p class="bt_tag" onclick="gtag.addTag(\''+gtag.id+'\'); return false;" title="'+MultiLang.findCommonResource("Control/Module/TagControl.ascx","gtag_Tag_Item_Tooltip")+'" style="font-size: 15px;cursor: pointer;">'+MultiLang.findCommonResource("Control/Module/TagControl.ascx","gtag_Tag_Item_PC")+'</p>';tag_html_str+='  <span class="num" id="'+gtag.id+'_tag_cnt" style="display:none;"></span>';tag_html_str+=' </div>';}
tag_html_str+=' <ul class="shpkw_tag_lst" id="'+gtag.id+'_tag_info"></div>';tag_html_str+='</div>';}
if($("#"+gtag.id).length>0){$("#"+gtag.id).html(tag_html_str);gtag.reset(gtag.id);DelayImageLoading.Init();}}
gtag.imageLoad=function(obj_id,img_url){var newImg=new Image();newImg.src=img_url;newImg.obj_id=obj_id;newImg.onload=function(){if(gtag.id!=newImg.obj_id)
gtag.reset(newImg.obj_id);gtag.width=newImg.width;gtag.height=newImg.height;var height_rate=1;var width_rate=1;if(gtag.height>gtag.max_height){height_rate=gtag.height/gtag.max_height;gtag.height=gtag.max_height;gtag.width=Math.round(gtag.width/height_rate);}
if(gtag.width>gtag.max_width){width_rate=gtag.width/gtag.max_width;gtag.width=gtag.max_width;gtag.height=Math.round(gtag.height/width_rate);}
$("#"+gtag.id+"_plat_img img").css("height",gtag.height);$("#"+gtag.id+"_plat_img img").css("width",gtag.width);if(gtag.height<gtag.width||gtag.width<gtag.max_width){gtag.margin_top=parseInt((gtag.max_height-gtag.height)/2);$("#"+gtag.id+"_plat_img img").css("padding-top",gtag.margin_top);}else gtag.margin_top=0;if(gtag.height>gtag.width||gtag.height<gtag.max_height){gtag.margin_left=parseInt((gtag.max_width-gtag.width)/2);$("#"+gtag.id+"_plat_img img").css("padding-left",gtag.margin_left);}else gtag.margin_left=0;gtag.max_top=gtag.max_height-gtag.tag_locate_limit;gtag.max_left=gtag.max_width-gtag.tag_locate_limit;$("#"+gtag.id+"_obj_info").attr("mode",gtag.mode);$("#"+gtag.id+"_obj_info").attr("max_width",gtag.max_width);$("#"+gtag.id+"_obj_info").attr("max_height",gtag.max_height);$("#"+gtag.id+"_obj_info").attr("limit_tag_cnt",gtag.limit_tag_cnt);$("#"+gtag.id+"_obj_info").attr("width",gtag.width);$("#"+gtag.id+"_obj_info").attr("height",gtag.height);$("#"+gtag.id+"_obj_info").attr("max_left",gtag.max_left);$("#"+gtag.id+"_obj_info").attr("max_top",gtag.max_top);$("#"+gtag.id+"_obj_info").attr("margin_left",gtag.margin_left);$("#"+gtag.id+"_obj_info").attr("margin_top",gtag.margin_top);$("#"+gtag.id+"_obj_info").attr("album_id",gtag.album_id);$("#"+gtag.id+"_obj_info").attr("album_img",gtag.album_img);};}
gtag.pointAddTag=function(event,obj_id){var pos_x=event.offsetX?(event.offsetX):0;var pos_y=event.offsetY?(event.offsetY):0;gtag.addTag(obj_id,pos_x,pos_y);}
gtag.addTag=function(obj_id,p_pos_x,p_pos_y,tag_name,tag_url,gd_no,rcmd_item_hide_yn,gd_nm,gd_img_url,gd_deal_price,gd_final_price,height,rate){if(obj_id!=undefined&&obj_id!=null&&obj_id!=""&&gtag.id!=obj_id)
gtag.reset(obj_id);if(height!=undefined&&height>0)
gtag.height=height;var tag_cnt=0;var tagno=1;var tag_priority=1;if($("#"+gtag.id+"_plat_div").length>0){if($("#"+gtag.id+"_plat_div").length>0){$("#"+gtag.id+"_plat_div").children("div").each(function(){if($(this).attr("type")=="tag")
tag_cnt++;});}
var tagno_str="";for(var i=1;i<=gtag.limit_tag_cnt;i++){tagno_str+=i+","}
for(var i=0;i<tag_cnt;i++){var cur_obj=$("#"+gtag.id+"_tag_info").children("li")[i];if(cur_obj!=undefined){tagno_str=tagno_str.replace(cur_obj.attributes.tagno.value+",","");}}
tagno=tagno_str.split(",")[0];for(var i=0;i<tag_cnt;i++){var cur_obj=$("#"+gtag.id+"_tag_info").children("li")[i];if(cur_obj!=undefined){var next_obj=null;if($("#"+gtag.id+"_tag_info").children("li")[i+1]!=undefined){next_obj=$("#"+gtag.id+"_tag_info").children("li")[i+1];var cur_tag_priority=parseInt(cur_obj.attributes.priority.value);var next_tag_priority=parseInt(next_obj.attributes.priority.value);if(next_tag_priority-cur_tag_priority>1){tag_priority=cur_tag_priority+1;}else tag_priority++;}else tag_priority++;}}}
var pos_x=0,pos_y=0;if(rate!=undefined&&rate>0){pos_x=p_pos_x*rate;pos_y=p_pos_y*rate;}else{if(p_pos_x!=null&&p_pos_x!="")
pos_x=p_pos_x;else{if(tagno>0&&(gtag.mode=="PC"||gtag.mode=="SS"))
pos_x=gtag.tag_locate_limit*tagno;else
pos_x=gtag.max_width/2;}
if(p_pos_y!=null&&p_pos_y!="")
pos_y=p_pos_y;else{if(tagno>0&&(gtag.mode=="PC"||gtag.mode=="SS"))
pos_y=gtag.tag_locate_limit*tagno;else
pos_y=gtag.max_height/2;}}
var tag_str="";if(tag_cnt<gtag.limit_tag_cnt){if(gtag.mode=="MB"){$('#'+gtag.id+'_tag_cnt').show();$('#'+gtag.id+'_tag_cnt').html(tag_cnt+1);}
var default_tag_name='';if(tag_name!=undefined&&tag_name!="")default_tag_name=tag_name;tag_str='<div class="tag" id="'+gtag.id+'_'+tagno+'_tag_div" type="tag" tagno="'+tagno+'" priority="'+tag_priority+'" objid="'+gtag.id+'" title="'+MultiLang.findCommonResource("Control/Module/TagControl.ascx","gtag_Tag_Tooltip")+'">';tag_str+=' <span class="txt" style="min-width: 30px;">'+default_tag_name+'</span>';tag_str+=' <a role="button" class="bt_del" onclick="gtag.deleteTag(\''+gtag.id+'\',\''+tagno+'\');">Delete</a>';tag_str+='</div>';$("#"+gtag.id+"_plat_div").append(tag_str);var tag_info_str='';tag_info_str+='<li id="'+gtag.id+'_'+tagno+'_info" tagno="'+tagno+'" priority="'+tag_priority+'">';tag_info_str+=' <div class="name" id="'+gtag.id+'_'+tagno+'_title">';tag_info_str+='  <label class="hide" for="'+gtag.id+'_'+tagno+'_title_txt">Tag Name</label>';tag_info_str+='  <input type="text" name="tag_name" maxlength="50" id="'+gtag.id+'_'+tagno+'_title_txt" class="ip_txt" value="'+default_tag_name+'" placeholder="'+MultiLang.findCommonResource("Control/Module/TagControl.ascx","gtag_Tag_Place_Holder_Str")+'" onkeyup="gtag.titleOnKeyEvent(\''+gtag.id+'\', $(this).val(), '+tagno+');" onkeydown="gtag.titleOnKeyEvent(\''+gtag.id+'\', $(this).val(), '+tagno+');"  onkeypress="gtag.titleOnKeyEvent(\''+gtag.id+'\', $(this).val(), '+tagno+');"  />';tag_info_str+=' </div>';if(gtag.mode=="MB"){tag_info_str+='<!-- Area : option -->';tag_info_str+='<div class="opt" id="'+gtag.id+'_'+tagno+'_option">';tag_info_str+=' <a role="button" class="lnk_sch '+(gd_no!=undefined&&gd_no!=""?"on":"")+'" onclick="gtag.linkBtnOnclick(\''+gtag.id+'\',\''+tagno+'\', \'I\');">Select Item</a>';tag_info_str+=' <a role="button" class="lnk_url '+(tag_url!=undefined&&tag_url!=""&&(gd_no==undefined||gd_no=="")?"on":"")+'" onclick="gtag.linkBtnOnclick(\''+gtag.id+'\',\''+tagno+'\', \'U\');">Url</a>';tag_info_str+='</div>';tag_info_str+='<!-- Area : nothing -->';tag_info_str+='<div class="area" id="'+gtag.id+'_'+tagno+'_nothing" style="display:'+(tag_url!=undefined&&tag_url!=""?"none":"block")+';">';tag_info_str+=' <p class="dsc">'+MultiLang.findCommonResource("Control/Module/TagControl.ascx","gtag_Tag_Description")+'</p>';tag_info_str+='</div>';tag_info_str+='<!-- Area : url -->';tag_info_str+='<div class="area" id="'+gtag.id+'_'+tagno+'_url" style="display:'+(tag_url!=undefined&&tag_url!=""&&(gd_no==undefined||gd_no=="")?"block":"none")+';">';tag_info_str+=' <input class="ip_url" type="text" id="'+gtag.id+'_'+tagno+'_url_txt" placeholder="url" value="'+(tag_url!=undefined&&tag_url!=""?tag_url:"")+'">';tag_info_str+=' <label class="ip_lb" for="'+gtag.id+'_'+tagno+'_url_txt">'+MultiLang.findCommonResource("Control/Module/TagControl.ascx","gtag_Url_Notice")+'</label>';tag_info_str+='</div>';tag_info_str+='<!-- Area : Item -->';tag_info_str+='<div class="area" id="'+gtag.id+'_'+tagno+'_item" style="display:'+(gd_no!=undefined&&gd_no!=""?"block":"none")+';">';tag_info_str+=' <div class="shpkw_related">';tag_info_str+='  <a>';tag_info_str+='   <dl>';tag_info_str+='   <dt class="sbj">'+(gd_no!=undefined&&gd_no!=""?gd_nm:"")+'</dt>';tag_info_str+='   <dd class="thmb"><img src="'+(gd_no!=undefined&&gd_no!=""?Public.GetDPImagePath(gd_img_url,75):"")+'" onerror="this.src=\'/gmkt.inc/Img/no_image.gif\';" alt=""/></dd>';tag_info_str+='   <dd class="dtl"><del>'+(gd_no!=undefined&&gd_no!=""&&gd_deal_price!=""&&gd_deal_price!=gd_final_price?gd_deal_price:"")+'</del> <strong class="prc">'+(gd_no!=undefined&&gd_no!=""&&gd_final_price!=""?gd_final_price:"")+'</strong></dd>';tag_info_str+='   <input class="url" type="hidden" value="'+(gd_no!=undefined&&gd_no!=""?tag_url:"")+'" />';tag_info_str+='   <input class="gd_no" type="hidden" value="'+(gd_no!=undefined&&gd_no!=""?gd_no:"")+'" />';tag_info_str+='   </dl>';tag_info_str+='  </a>';tag_info_str+=' </div>';tag_info_str+=' <div class="opt_check">';tag_info_str+='  <input class="ip_chck" id="'+gtag.id+'_'+tagno+'_rcmd_item_add_chk" type="checkbox" '+(rcmd_item_hide_yn=='Y'?'checked="checked"':'')+'>';tag_info_str+='  <label class="lb_chck" for="'+gtag.id+'_'+tagno+'_rcmd_item_add_chk">'+MultiLang.findCommonResource("Control/Module/TagControl.ascx","gtag_TagItemHideRecommendNotice")+'</label>';tag_info_str+=' </div>';tag_info_str+='</div>';}
else{tag_info_str+='<!-- Area : option -->';tag_info_str+='<div class="opt fs_11" id="'+gtag.id+'_'+tagno+'_option">';tag_info_str+=' <a class="lnk_sch" title="'+MultiLang.findCommonResource("Control/Module/TagControl.ascx","gtag_AddItem_Tooltip")+'" onclick="gtag.linkBtnOnclick(\''+gtag.id+'\',\''+tagno+'\', \'I\');">'+MultiLang.findCommonResource("Control/Module/TagControl.ascx","gtag_Add_Item")+'</a>';tag_info_str+=' <a class="lnk_url" title="'+MultiLang.findCommonResource("Control/Module/TagControl.ascx","gtag_AddEditUrl_Tooltip")+'" onclick="gtag.linkBtnOnclick(\''+gtag.id+'\',\''+tagno+'\', \'U\');" id="'+gtag.id+'_'+tagno+'_option_url">'+(tag_url!=undefined&&tag_url!=""&&(gd_no==undefined||gd_no=="")?MultiLang.findCommonResource("Control/Module/TagControl.ascx","gtag_Edit_Url"):MultiLang.findCommonResource("Control/Module/TagControl.ascx","gtag_Add_Url"))+'</a>';tag_info_str+='</div>';tag_info_str+='<!-- Area : url & Item -->';tag_info_str+='<div class="area_url" id="'+gtag.id+'_'+tagno+'_url" style="display:'+(tag_url!=undefined&&tag_url!=""?"block":"none")+';">';tag_info_str+=' <span class="url" id="'+gtag.id+'_'+tagno+'_url_txt" style="display:'+(tag_url!=undefined&&tag_url!=""?"block":"none")+';">'+(tag_url!=undefined&&tag_url!=""?tag_url:"")+'</span>';tag_info_str+=' <div class="url_form">';tag_info_str+='  <label class="hide" for="'+gtag.id+'_'+tagno+'_url_txt_temp">Insert URL here</label>';tag_info_str+='  <input type="text" class="ip_url" style="display:none;" id="'+gtag.id+'_'+tagno+'_url_txt_temp" placeholder="Insert URL here" value="'+(tag_url!=undefined&&tag_url!=""?tag_url:"")+'">';tag_info_str+='  <a class="btn_save fs_11" id="'+gtag.id+'_'+tagno+'_url_txt_save" style="display:none;" onclick="gtag.linkSaveBtnOnclick(\''+gtag.id+'\',\''+tagno+'\');">'+MultiLang.findCommonResource("Control/Module/TagControl.ascx","gtag_Save")+'</a>';tag_info_str+=' </div>';tag_info_str+='</div>';tag_info_str+='<div class="area_item" id="'+gtag.id+'_'+tagno+'_item" style="display:'+(tag_url!=undefined&&tag_url!=""&&(gd_no==undefined||gd_no!="")?"block":"none")+';">';tag_info_str+=' <div class="opt_check">';tag_info_str+='  <input class="gd_no" id="'+gtag.id+'_'+tagno+'_gd_no" type="hidden" value="'+(gd_no!=undefined&&gd_no!=""?gd_no:"")+'" />';if(gtag.mode!="SS")
{tag_info_str+='  <input class="ip_chck" id="'+gtag.id+'_'+tagno+'_rcmd_item_add_chk" type="checkbox" '+(rcmd_item_hide_yn=='Y'?'checked="checked"':'')+'>';tag_info_str+='  <label class="lb_chck" for="'+gtag.id+'_'+tagno+'_rcmd_item_add_chk">'+MultiLang.findCommonResource("Control/Module/TagControl.ascx","gtag_TagItemHideRecommendNotice")+'</label>';}
tag_info_str+=' </div>';tag_info_str+='</div>';}
tag_info_str+=' <!-- Area : Locate -->';tag_info_str+=' <input type="hidden" id="'+gtag.id+'_'+tagno+'_pos_x" value="'+pos_x+'" />';tag_info_str+=' <input type="hidden" id="'+gtag.id+'_'+tagno+'_pos_y" value="'+pos_y+'" />';tag_info_str+='</li>';$("#"+gtag.id+"_tag_info").append(tag_info_str);if(GMKT.DeviceInfo.Kind=='Mobile'||GMKT.DeviceInfo.Kind=='Tablet'){$("#"+gtag.id+"_"+tagno+"_tag_div").touch(gtag.touch);$("#"+gtag.id+"_"+tagno+"_tag_div").css(gtouch.styleProperty+"Transform",'translate3d('+pos_x+'px, '+(-gtag.max_height+pos_y)+'px, 0px)');}else if(GMKT.DeviceInfo.Kind=='Desktop'){$("#"+gtag.id+"_"+tagno+"_tag_div").draggable(gtag.drag);$("#"+gtag.id+"_"+tagno+"_tag_div").css('top',pos_y);$("#"+gtag.id+"_"+tagno+"_tag_div").css('left',pos_x);}}else
alert(String.format(MultiLang.findCommonResource("Control/Module/TagControl.ascx","gtag_Tag_Limit_Notice_Popup"),gtag.limit_tag_cnt));}
gtag.deleteTag=function(obj_id,tagno){if(obj_id!=undefined&&obj_id!=null&&obj_id!=""&&gtag.id!=obj_id)
gtag.reset(obj_id);var remove_tag_priority=parseInt($('#'+gtag.id+'_'+tagno+'_tag_div').attr("priority"));$('#'+gtag.id+'_'+tagno+'_tag_div').remove();$('#'+gtag.id+'_'+tagno+'_info').remove();var tag_cnt=0;if($("#"+gtag.id+"_plat_div").length>0){$("#"+gtag.id+"_plat_div").children("div").each(function(){if($(this).attr("type")=="tag")
tag_cnt++;});}
$('#'+gtag.id+'_tag_cnt').html(tag_cnt);if(tag_cnt<=0)
$('#'+gtag.id+'_tag_cnt').hide();for(var i=0;i<=tag_cnt;i++){var cur_obj=$("#"+gtag.id+"_plat_div").children("div")[i];if(cur_obj!=undefined&&cur_obj.attributes.type!=undefined&&cur_obj.attributes.type.value=="tag"){var cur_tag_priority=parseInt(cur_obj.attributes.priority.value);if(cur_tag_priority>remove_tag_priority){cur_obj.attributes.priority.value=parseInt(cur_obj.attributes.priority.value)-1;}}}
for(var i=0;i<tag_cnt;i++){var cur_obj=$("#"+gtag.id+"_tag_info").children("li")[i];if(cur_obj!=undefined){var cur_tag_priority=parseInt(cur_obj.attributes.priority.value);if(cur_tag_priority>remove_tag_priority){cur_obj.attributes.priority.value=parseInt(cur_obj.attributes.priority.value)-1;}}}}
gtag.titleOnKeyEvent=function(obj_id,str,tagno){if(obj_id!=undefined&&obj_id!=null&&obj_id!=""&&gtag.id!=obj_id)
gtag.reset(obj_id);$("#"+gtag.id+"_"+tagno+"_tag_div .txt").html(str);if(gtag.mode=="SS"){$("#div_tag_editer_plat_div").find('div[objid *= div_tag_editer]').removeClass('tag_s')
$("#"+gtag.id+"_"+tagno+"_tag_div").addClass('tag_s');}}
gtag.linkBtnOnclick=function(obj_id,tag_no,type){if(obj_id!=undefined&&obj_id!=null&&obj_id!=""&&gtag.id!=obj_id)
gtag.reset(obj_id);if(gtag.mode=="MB"){$('#'+gtag.id+'_'+tag_no+'_option a').removeClass("on");$('#'+gtag.id+'_'+tag_no+'_item').hide();if(type=="U"){$('#'+gtag.id+'_'+tag_no+'_item .shpkw_related .sbj').html('');$('#'+gtag.id+'_'+tag_no+'_item .shpkw_related .thmb img').attr("src",'');$('#'+gtag.id+'_'+tag_no+'_item .shpkw_related .dtl del').html('');$('#'+gtag.id+'_'+tag_no+'_item .shpkw_related .dtl .prc').html('');$('#'+gtag.id+'_'+tag_no+'_item .shpkw_related .url').val('');$('#'+gtag.id+'_'+tag_no+'_option .lnk_url').addClass("on");$('#'+gtag.id+'_'+tag_no+'_nothing').hide();$('#'+gtag.id+'_'+tag_no+'_url').show();$('#'+gtag.id+'_'+tag_no+'_item .shpkw_related .url').val("");$('#'+gtag.id+'_'+tag_no+'_item .shpkw_related .gd_no').val("");$('#'+gtag.id+'_'+tag_no+'_rcmd_item_add_chk').prop("checked",false);}
else{$('#'+gtag.id+'_'+tag_no+'_url_txt').val('');$('#'+gtag.id+'_'+tag_no+'_option .lnk_sch').addClass("on");$('#'+gtag.id+'_'+tag_no+'_nothing').show();$('#'+gtag.id+'_'+tag_no+'_url').hide();gtag.t_cur_tag_no=tag_no;var add_param="0";var gd_no=$('#'+gtag.id+'_'+tag_no+'_item .shpkw_related .gd_no').val();if(gd_no!="")
add_param="1&gd_no_list="+gd_no+",";window.open(Public.convertNormalFullUrl("/Mobile/My/ShoppingTalkThemeMgmtPopup.aspx?max_count=1&call_back_func=gtagGetItemInfo&selCount="+add_param));}}else{$('#'+gtag.id+'_'+tag_no+'_url').show();$('#'+gtag.id+'_'+tag_no+'_item').hide();if(type=="U"){var url_txt=$('#'+gtag.id+'_'+tag_no+'_url_txt').html();if($('#'+gtag.id+'_'+tag_no+'_gd_no').val()!=""){url_txt="";$('#'+gtag.id+'_'+tag_no+'_gd_no').val("");}
$('#'+gtag.id+'_'+tag_no+'_url_txt_temp').val(url_txt);$('#'+gtag.id+'_'+tag_no+'_url_txt_temp').show();$('#'+gtag.id+'_'+tag_no+'_url_txt_save').show();$('#'+gtag.id+'_'+tag_no+'_rcmd_item_add_chk').prop("checked",false);}
else{$('#'+gtag.id+'_'+tag_no+'_option_url').html(MultiLang.findCommonResource("Control/Module/TagControl.ascx","gtag_Add_Url"));$('#'+gtag.id+'_'+tag_no+'_url_txt').html('');$('#'+gtag.id+'_'+tag_no+'_url_txt_temp').val('');$('#'+gtag.id+'_'+tag_no+'_url_txt_temp').hide();$('#'+gtag.id+'_'+tag_no+'_url_txt_save').hide();gtag.t_cur_tag_no=tag_no;var add_param="0";var gd_no=$('#'+gtag.id+'_'+tag_no+'_gd_no').val();if(gd_no!="")
add_param="1&rcmd_gd_no_list="+gd_no+",";window.Util.openPopupScroll(Public.getAppPath()+"/My/RecommendedItemPopUp.aspx?max_count=1&call_back_func=gtagGetItemInfo&selCount="+add_param,980,740,null,200,200);}}}
gtag.linkSaveBtnOnclick=function(obj_id,tag_no){if(obj_id!=undefined&&obj_id!=null&&obj_id!=""&&gtag.id!=obj_id)
gtag.reset(obj_id);var url_txt=$('#'+gtag.id+'_'+tag_no+'_url_txt_temp').val();$('#'+gtag.id+'_'+tag_no+'_option_url').html((url_txt!=""?MultiLang.findCommonResource("Control/Module/TagControl.ascx","gtag_Edit_Url"):MultiLang.findCommonResource("Control/Module/TagControl.ascx","gtag_Add_Url")));$('#'+gtag.id+'_'+tag_no+'_url_txt').html(url_txt);$('#'+gtag.id+'_'+tag_no+'_url_txt_save').hide();$('#'+gtag.id+'_'+tag_no+'_url_txt_temp').hide();$('#'+gtag.id+'_'+tag_no+'_url_txt').show();$('#'+gtag.id+'_'+tag_no+'_gd_no').val('');}
function gtagGetItemInfo(gd_no){var currency_cd=(GMKT.ServiceInfo.region=="US"?GMKT.ServiceInfo.currencyCode:GMKT.ServiceInfo.viewCurrencyCode);if(gtag.mode=="MB"){var param=new RMSParam();param.add("gd_no_list",gd_no);param.add("sell_cust_no","");var result=RMSHelper.callWebMethod(Public.getServiceUrl("swe_EventAjaxService.asmx"),"GetRecommendGoodsInfoByGdNoList",param.toJson());$('#'+gtag.id+'_'+gtag.t_cur_tag_no+'_url').hide();if(result!=null&&result.Rows.length>0){var gd_deal_price_1=parseInt(result.Rows[0]["deal_price"]);var gd_deal_price_2=parseInt(result.Rows[0]["sell_price"]);var gd_deal_price=(gd_deal_price_1>0?gtag.getPriceStr(gd_deal_price_1,currency_cd):gd_deal_price_2>0?gtag.getPriceStr(gd_deal_price_2,currency_cd):"");var gd_final_price=(parseInt(result.Rows[0]["final_price"])>0?gtag.getPriceStr(result.Rows[0]["final_price"].toString(),currency_cd):"");$('#'+gtag.id+'_'+gtag.t_cur_tag_no+'_item .shpkw_related .sbj').html(result.Rows[0]["gd_nm"].toString());$('#'+gtag.id+'_'+gtag.t_cur_tag_no+'_item .shpkw_related .thmb img').attr("src",result.Rows[0]["img_url"].toString());$('#'+gtag.id+'_'+gtag.t_cur_tag_no+'_item .shpkw_related .dtl del').html(gd_deal_price!=""&&gd_deal_price!=gd_final_price?gd_deal_price:"");$('#'+gtag.id+'_'+gtag.t_cur_tag_no+'_item .shpkw_related .dtl .prc').html(gd_final_price!=""?gd_final_price:"");$('#'+gtag.id+'_'+gtag.t_cur_tag_no+'_item .shpkw_related .url').val("http://"+Public.getCurrentHost()+"/g/"+result.Rows[0]["gd_no"].toString());$('#'+gtag.id+'_'+gtag.t_cur_tag_no+'_item .shpkw_related .gd_no').val(result.Rows[0]["gd_no"].toString());$('#'+gtag.id+'_'+gtag.t_cur_tag_no+'_nothing').hide();$('#'+gtag.id+'_'+gtag.t_cur_tag_no+'_item').show();}else{$('#'+gtag.id+'_'+gtag.t_cur_tag_no+'_item .shpkw_related .sbj').html("");$('#'+gtag.id+'_'+gtag.t_cur_tag_no+'_item .shpkw_related .thmb img').attr("src","");$('#'+gtag.id+'_'+gtag.t_cur_tag_no+'_item .shpkw_related .dtl del').html("");$('#'+gtag.id+'_'+gtag.t_cur_tag_no+'_item .shpkw_related .dtl .prc').html("");$('#'+gtag.id+'_'+gtag.t_cur_tag_no+'_item .shpkw_related .url').val("");$('#'+gtag.id+'_'+gtag.t_cur_tag_no+'_item .shpkw_related .gd_no').val("");$('#'+gtag.id+'_'+gtag.t_cur_tag_no+'_nothing').show();$('#'+gtag.id+'_'+gtag.t_cur_tag_no+'_item').hide();}}else{$('#'+gtag.id+'_'+gtag.t_cur_tag_no+'_url_txt_save').hide();$('#'+gtag.id+'_'+gtag.t_cur_tag_no+'_url_txt_temp').hide();if(gd_no!=null&&gd_no.length>0){if(gd_no!=null&&gd_no.length>0){var resultData=RMSHelper.dynamic.executeToDataTable("Special.GetSelectedDataInfo",RMSParam.create().add("gd_no",gd_no[0].gd_no));var result=resultData.ReturnData;if(result!=null&&result.Rows.length>0){var url_txt="http://"+Public.getCurrentHost()+"/g/"+result.Rows[0]["gd_no"].toString();$('#'+gtag.id+'_'+gtag.t_cur_tag_no+'_option_url').html((url_txt!=""?MultiLang.findCommonResource("Control/Module/TagControl.ascx","gtag_Edit_Url"):MultiLang.findCommonResource("Control/Module/TagControl.ascx","gtag_Add_Url")));$('#'+gtag.id+'_'+gtag.t_cur_tag_no+'_url_txt').html(url_txt);$('#'+gtag.id+'_'+gtag.t_cur_tag_no+'_url_txt_temp').val(url_txt);$('#'+gtag.id+'_'+gtag.t_cur_tag_no+'_gd_no').val(result.Rows[0]["gd_no"].toString());$('#'+gtag.id+'_'+gtag.t_cur_tag_no+'_item').show();$('#'+gtag.id+'_'+gtag.t_cur_tag_no+'_url_txt').show();}}}
else{$('#'+gtag.id+'_'+gtag.t_cur_tag_no+'_url_txt').html("");$('#'+gtag.id+'_'+gtag.t_cur_tag_no+'_url_txt_temp').val("");$('#'+gtag.id+'_'+gtag.t_cur_tag_no+'_gd_no').val("");$('#'+gtag.id+'_'+gtag.t_cur_tag_no+'_item').hide();$('#'+gtag.id+'_'+gtag.t_cur_tag_no+'_url_txt').hide();}}
gtag.t_cur_tag_no=0;}
gtag.mobileCheckTagTitleByObjId=function(obj_id){if(obj_id!=undefined&&obj_id!=null&&obj_id!=""&&gtag.id!=obj_id)
gtag.reset(obj_id);var b_check=true;var tags_array=new Array();$("#"+gtag.id+"_plat_div").children("div").each(function(){if($(this).attr("type")=="tag"){var tagno=$(this).attr("tagno");var title=$("#"+gtag.id+"_"+tagno+"_title_txt").val();var url="";if($('#'+gtag.id+'_'+tagno+'_option .lnk_url').hasClass("on")){url=$("#"+gtag.id+"_"+tagno+"_url .ip_url").val();if(url.indexOf("http://")<0&&url.indexOf("https://")<0)
url="http://"+url;}
else if($('#'+gtag.id+'_'+tagno+'_option .lnk_sch').hasClass("on")){url=$('#'+gtag.id+'_'+tagno+'_item .shpkw_related .url').val();}
if(title==""&&url!="")
b_check=false;}});return b_check;}
gtag.pcCheckTagTitleByObjId=function(obj_id){if(obj_id!=undefined&&obj_id!=null&&obj_id!=""&&gtag.id!=obj_id)
gtag.reset(obj_id);var b_check=true;var tags_array=new Array();$("#"+gtag.id+"_plat_div").children("div").each(function(){if($(this).attr("type")=="tag"){var tagno=$(this).attr("tagno");var title=$("#"+gtag.id+"_"+tagno+"_title_txt").val();var url=$('#'+gtag.id+'_'+tagno+'_url_txt').html();if(title==""&&url!="")
b_check=false;}});return b_check;}
gtag.getTagComment=function(obj_id){if(obj_id!=undefined&&obj_id!=null&&obj_id!=""&&gtag.id!=obj_id)
gtag.reset(obj_id);return $("#"+gtag.id+"_tag_comment").val();}
gtag.mobileGetAllTagTitleByObjId=function(obj_id){var return_str="";if(obj_id!=undefined&&obj_id!=null&&obj_id!=""&&gtag.id!=obj_id)
gtag.reset(obj_id);var tags_array=new Array();$("#"+gtag.id+"_plat_div").children("div").each(function(){if($(this).attr("type")=="tag"){var tagno=$(this).attr("tagno");var title=$("#"+gtag.id+"_"+tagno+"_title_txt").val();if(return_str!="")return_str+=",";return_str+=title;}});return return_str;}
gtag.pcGetAllTagTitleByTagStr=function(tag_str){var return_str="";try{var t_obj=JSON.parse(tag_str);if(t_obj!=undefined&&t_obj!=null){if(t_obj.tags!=undefined&&t_obj.tags!=null&&t_obj.tags.length>0){for(var i=0;i<t_obj.tags.length;i++){var tag_title=t_obj.tags[i].tag[0].title
if(return_str!="")return_str+=",";return_str+=tag_title;}}}}catch(e){return_str=tag_str;}
return return_str;}
gtag.getJsonStr=function(obj_id){var return_str="";if(obj_id!=undefined&&obj_id!=null&&obj_id!=""&&gtag.id!=obj_id)
gtag.reset(obj_id);var img_url=$("#"+gtag.id+"_plat_img img").attr("src");var tag_comment=$("#"+gtag.id+"_tag_comment").val();var tags_array=new Array();$("#"+gtag.id+"_plat_div").children("div").each(function(){if($(this).attr("type")=="tag"){var tagno=$(this).attr("tagno");var pos_x=$("#"+gtag.id+"_"+tagno+"_pos_x").val();var pos_y=$("#"+gtag.id+"_"+tagno+"_pos_y").val();var url="";var rcmd_item_hide_yn="N";if(gtag.mode=="MB"){if($('#'+gtag.id+'_'+tagno+'_option .lnk_url').hasClass("on")){url=$("#"+gtag.id+"_"+tagno+"_url .ip_url").val();if(url.indexOf("http://")<0&&url.indexOf("https://")<0)
url="http://"+url;}
else if($('#'+gtag.id+'_'+tagno+'_option .lnk_sch').hasClass("on")){url=$('#'+gtag.id+'_'+tagno+'_item .shpkw_related .url').val();if($('#'+gtag.id+'_'+tagno+'_rcmd_item_add_chk').prop("checked")==true)
rcmd_item_hide_yn="Y";}}else{url=$('#'+gtag.id+'_'+tagno+'_url_txt').html();if(url!=""&&$('#'+gtag.id+'_'+tagno+'_gd_no').val()==""){if(url.indexOf("http://")<0&&url.indexOf("https://")<0)
url="http://"+url;}else if(url!=""&&$('#'+gtag.id+'_'+tagno+'_gd_no').val()!=""){if($('#'+gtag.id+'_'+tagno+'_rcmd_item_add_chk').prop("checked")==true)
rcmd_item_hide_yn="Y";}}
var title=$("#"+gtag.id+"_"+tagno+"_title_txt").val();if(title!="")
tags_array.push({"tag":[{"x":pos_x,"y":pos_y,"title":title,"url":url,"rcmd_item_hide_yn":rcmd_item_hide_yn}]});}});var json_obj={"tags":tags_array,"img_url":Public.GetDPImagePath(img_url,0),"comment":tag_comment,"max_width":gtag.max_width,"width":gtag.width,"height":gtag.height,"album_id":gtag.album_id,"album_img":gtag.album_img};return_str=JSON.stringify(json_obj);return return_str;}
gtag.getImgLogNo=function(obj_id){if(obj_id!=undefined&&obj_id!=null&&obj_id!=""&&gtag.id!=obj_id)
gtag.reset(obj_id);return log_no=$("#"+gtag.id+"_img_log_no").val();}
gtag.commitFileUpload=function(obj_id){if(obj_id!=undefined&&obj_id!=null&&obj_id!=""&&gtag.id!=obj_id)
gtag.reset(obj_id);var log_no=$("#"+gtag.id+"_img_log_no").val();if(commitFileUpload!=undefined){commitFileUpload(log_no,"");}}
gtag.getImgUrl=function(obj_id){if(obj_id!=undefined&&obj_id!=null&&obj_id!=""&&gtag.id!=obj_id)
gtag.reset(obj_id);var img_url=$("#"+gtag.id+"_plat_img img").attr("src");return img_url;}
gtag.getStickerAlbumNo=function(obj_id){if(obj_id!=undefined&&obj_id!=null&&obj_id!=""&&gtag.id!=obj_id)
gtag.reset(obj_id);return parseInt($("#"+gtag.id+"_obj_info").attr("album_id"));}
gtag.setTagBoxEdit=function(mode,id,max_width,max_height,limit_tag_cnt,tag_box_obj){var t_obj;if(mode=="MB")
t_obj=JSON.parse(tag_box_obj.tagboxs[0].tagbox);else
t_obj=tag_box_obj;gtag.render(mode,id,max_width,max_height,t_obj.img_url,limit_tag_cnt,"",t_obj.comment,(t_obj.album_id!=undefined?t_obj.album_id:0),(t_obj.album_img!=undefined?t_obj.album_img:""));if(t_obj.tags!=undefined&&t_obj.tags.length>0){var gd_no_list="";var tag_info_list=new Array();for(var i=0;i<t_obj.tags.length;i++){var gd_no="";var tags_obj=t_obj.tags[i].tag[0];if(tags_obj.url.indexOf("/g/")>0&&tags_obj.url.split('/g/')[1]!=""){gd_no=tags_obj.url.split('/g/')[1];gd_no_list+=gd_no+",";}
var rcmd_item_hide_yn=(tags_obj.rcmd_item_hide_yn!=undefined&&tags_obj.rcmd_item_hide_yn!=""?tags_obj.rcmd_item_hide_yn:"N");tag_info_list.push({"x":tags_obj.x,"y":tags_obj.y,"title":tags_obj.title,"url":tags_obj.url,"gd_no":gd_no,"rcmd_item_hide_yn":rcmd_item_hide_yn,"gd_nm":"","gd_img_url":"","gd_deal_price":"","gd_final_price":""});}
var gd_dict=new Object();if(gd_no_list!=""){var param=new RMSParam();param.add("gd_no_list",gd_no_list);param.add("sell_cust_no","");var result=RMSHelper.callWebMethod(Public.getServiceUrl("swe_EventAjaxService.asmx"),"GetRecommendGoodsInfoByGdNoList",param.toJson());if(result!=null&&result.Rows.length>0){var currency_cd=(GMKT.ServiceInfo.region=="US"?GMKT.ServiceInfo.currencyCode:GMKT.ServiceInfo.viewCurrencyCode);for(var i=0;i<result.Rows.length;i++){var gd_deal_price_1=parseInt(result.Rows[i]["deal_price"]);var gd_deal_price_2=parseInt(result.Rows[i]["sell_price"]);var gd_deal_price=(gd_deal_price_1>0?gtag.getPriceStr(gd_deal_price_1,currency_cd):gd_deal_price_2>0?gtag.getPriceStr(gd_deal_price_2,currency_cd):"");var gd_final_price="";if(result.Rows[i]["trad_way"]=="T2")
gd_final_price=gtag.getPriceStr(result.Rows[i]["succ_bid_poss_price"].toString(),currency_cd);else
gd_final_price=(parseInt(result.Rows[i]["final_price"])>0?gtag.getPriceStr(result.Rows[i]["final_price"].toString(),currency_cd):"");gd_dict[result.Rows[i]["gd_no"].toString()]={"gd_nm":result.Rows[i]["gd_nm"].toString(),"gd_img_url":result.Rows[i]["img_url"].toString(),"gd_deal_price":gd_deal_price,"gd_final_price":gd_final_price};}}}
for(var i=0;i<tag_info_list.length;i++){if(tag_info_list[i].gd_no!="")
{if(gd_dict[tag_info_list[i].gd_no]!=null){tag_info_list[i].gd_nm=gd_dict[tag_info_list[i].gd_no].gd_nm;tag_info_list[i].gd_img_url=gd_dict[tag_info_list[i].gd_no].gd_img_url;tag_info_list[i].gd_deal_price=gd_dict[tag_info_list[i].gd_no].gd_deal_price;tag_info_list[i].gd_final_price=gd_dict[tag_info_list[i].gd_no].gd_final_price;}else{tag_info_list[i].url=null;tag_info_list[i].rcmd_item_hide_yn=null;tag_info_list[i].gd_no=null;tag_info_list[i].gd_nm=null;tag_info_list[i].gd_img_url=null;tag_info_list[i].gd_deal_price=null;tag_info_list[i].gd_final_price=null;}}}
var rate=max_width/t_obj.max_width;var height=t_obj.height*rate;for(var i=0;i<tag_info_list.length;i++){gtag.addTag(id,tag_info_list[i].x,tag_info_list[i].y,tag_info_list[i].title,tag_info_list[i].url,tag_info_list[i].gd_no,tag_info_list[i].rcmd_item_hide_yn,tag_info_list[i].gd_nm,tag_info_list[i].gd_img_url,tag_info_list[i].gd_deal_price,tag_info_list[i].gd_final_price,height,rate);}}}
gtag.getTagItemList=function(json_tagbox_obj,tag_item_return_func,target_id){var tag_item_list="";for(var k=0;k<json_tagbox_obj.length;k++){var tag_box_obj=json_tagbox_obj[k];try{var t_obj=JSON.parse(tag_box_obj.tagboxs[0].tagbox);if(t_obj.tags!=undefined&&t_obj.tags.length>0){for(var i=0;i<t_obj.tags.length;i++){var gd_no="";var tags_obj=t_obj.tags[i].tag[0];if(tags_obj.url.indexOf("qoo10")>0&&tags_obj.url.indexOf("/g/")>0&&tags_obj.url.split('/g/')[1]!="")
gd_no=tags_obj.url.split('/g/')[1];var rcmd_item_hide_yn=(tags_obj.rcmd_item_hide_yn!=undefined&&tags_obj.rcmd_item_hide_yn!=""?tags_obj.rcmd_item_hide_yn:"N");if(rcmd_item_hide_yn=="N"&&tag_item_list.indexOf(gd_no)<0)
tag_item_list+=gd_no+",";}}}catch(e){}}
if(tag_item_return_func!=""&&window[tag_item_return_func])
window[tag_item_return_func](tag_item_list,target_id);}
gtag.getTagBoxStr=function(id,max_width,max_height,tag_box_obj,type,affiliate_contract_cd){var html_tag='';var html_img_tag='';var tag_item_list="";try{var t_obj=tag_box_obj;if(t_obj.tags!=undefined&&t_obj.tags.length>0){var gd_no_list="";var tag_info_list=new Array();for(var i=0;i<t_obj.tags.length;i++){var gd_no="";var tags_obj=t_obj.tags[i].tag[0];if(tags_obj.url.indexOf("qoo10")>0&&tags_obj.url.indexOf("/g/")>0&&tags_obj.url.split('/g/')[1]!=""){gd_no=tags_obj.url.split('/g/')[1];gd_no_list+=gd_no+",";}
var rcmd_item_hide_yn=(tags_obj.rcmd_item_hide_yn!=undefined&&tags_obj.rcmd_item_hide_yn!=""?tags_obj.rcmd_item_hide_yn:"N");tag_info_list.push({"x":tags_obj.x,"y":tags_obj.y,"title":tags_obj.title,"url":tags_obj.url,"gd_no":gd_no,"rcmd_item_hide_yn":rcmd_item_hide_yn});}
var rate=max_width/t_obj.max_width;for(var i=0;i<tag_info_list.length;i++){var pos_x=tag_info_list[i].x*rate;var pos_y=tag_info_list[i].y*rate;var title='<span class="txt">'+tag_info_list[i].title+'</span>';var cls='';if(tag_info_list[i].url!=""){var url=tag_info_list[i].url;if(url.indexOf("http://")<0&&url.indexOf("https://")<0)
url="http://"+url;if(url.indexOf("/g/")>=0&&affiliate_contract_cd!=undefined&&affiliate_contract_cd!="")
url+="?sAffiliate="+affiliate_contract_cd;if(type=="V")
title='<a onclick="gtag.openUrl(\''+url+'\');">'+title+'</a>';cls='tag_s';}
html_img_tag+='<div class="tag '+cls+'" style="top:'+pos_y+'px; left:'+pos_x+'px;">'+title+'</div>';}}
var resize_img_url=Public.GetDPImagePath(t_obj.img_url,max_width);html_tag+='<div class="shpkw_img">';html_tag+=' <div class="img"><img id="'+id+'_img" src="'+Public.GetLoadingImage(max_width)+'" gd_src="'+resize_img_url+'" alt="" load="N" resizing="true"></div>';html_tag+=html_img_tag;html_tag+='</div>';html_tag+='<div class="para">'+t_obj.comment+'</div>';}catch(e){html_tag+='';}
$("#"+id).html(html_tag);}
gtag.getAllTagBoxStr=function(id_title,max_width,max_height,json_tagbox_obj,tag_item_return_func,affiliate_contract_cd){var tag_item_list="";for(var k=0;k<json_tagbox_obj.length;k++){var tag_box_obj=json_tagbox_obj[k];var html_tag='';var html_img_tag='';var id=id_title+(k+1);try{var t_obj=JSON.parse(tag_box_obj.tagboxs[0].tagbox);if(t_obj.tags!=undefined&&t_obj.tags.length>0){var tag_info_list=new Array();for(var i=0;i<t_obj.tags.length;i++){var gd_no="";var tags_obj=t_obj.tags[i].tag[0];if(tags_obj.url.indexOf("qoo10")>0&&tags_obj.url.indexOf("/g/")>0&&tags_obj.url.split('/g/')[1]!="")
gd_no=tags_obj.url.split('/g/')[1];var rcmd_item_hide_yn=(tags_obj.rcmd_item_hide_yn!=undefined&&tags_obj.rcmd_item_hide_yn!=""?tags_obj.rcmd_item_hide_yn:"N");if(rcmd_item_hide_yn=="N")
tag_item_list+=gd_no+",";tag_info_list.push({"x":tags_obj.x,"y":tags_obj.y,"title":tags_obj.title,"url":tags_obj.url,"gd_no":gd_no,"rcmd_item_hide_yn":rcmd_item_hide_yn,"gd_nm":"","gd_img_url":"","gd_deal_price":"","gd_final_price":""});}
var rate=max_width/t_obj.max_width;for(var i=0;i<tag_info_list.length;i++){var pos_x=tag_info_list[i].x*rate;var pos_y=tag_info_list[i].y*rate;var title='<span class="txt">'+tag_info_list[i].title+'</span>';var cls='';if(tag_info_list[i].url!=""){var url=tag_info_list[i].url;if(url.indexOf("http://")<0&&url.indexOf("https://")<0)
url="http://"+url;if(url.indexOf("/g/")>=0&&affiliate_contract_cd!=undefined&&affiliate_contract_cd!="")
url+="?sAffiliate="+affiliate_contract_cd;title='<a onclick="gtag.openUrl(\''+url+'\');">'+title+'</a>';cls='tag_s';}
html_img_tag+='<div class="tag '+cls+'" style="top:'+pos_y+'px; left:'+pos_x+'px;">'+title+'</div>';}}
var album_down_url="";if(t_obj.album_id!=undefined&&parseInt(t_obj.album_id)>0)
album_down_url=Public.getMobileServerUrl('/Mobile/Qtalk/Emoticon/AlbumDownload.aspx?album_type=S&trade_type=B&studio_header=Y&my_album_id='+t_obj.album_id);var album_img=t_obj.album_img!=undefined&&t_obj.album_img!=""?t_obj.album_img:"";var resize_img_url=Public.GetDPImagePath(t_obj.img_url,max_width);html_tag+='<div class="shpkw_img" style="height:'+max_width+'px;">';html_tag+=' <div class="img"><img id="'+id+'_img" src="'+Public.GetLoadingImage(max_width)+'" gd_src="'+resize_img_url+'" alt="" load="N" resizing="true"></div>';html_tag+=html_img_tag;if(album_down_url!="")
html_tag+='<a class="get_stkr" onclick="MobileUtil.goQtalkPageFailStore(\''+album_down_url+'\');"><span class="thmb"><img src="'+album_img+'" alt=""></span><span class="txt">'+MultiLang.findCommonResource("Control/Module/TagControl.ascx","gtag_Get_Sticker")+'</span></a>';html_tag+='<a id="btn_imgsrch_'+k+'"  class="btn_imgsrch" title="search by image" onclick="parent.goImageSearchResult('+k+');">'+' <img src="'+Public.GetStaticImagePath("/cm/mobile/image/common/icon_flag_imgsrch.png")+'" alt="Search by image"/>'+'</a>';html_tag+='</div>';if(html_img_tag!="")
html_tag+='<a class="show_tag hid" onclick="gtag.hideTag($(this), \''+id+'\'); return false;">'+MultiLang.findCommonResource("Control/Module/TagControl.ascx","gtag_Hide_Tag")+'</a>';html_tag+='<p class="para">'+gtag.setNewLineToBRTag(t_obj.comment)+'</p>';}catch(e){html_tag+='';}
$("#"+id).append(html_tag);}
if(tag_item_list!=""&&tag_item_return_func!=""&&window[tag_item_return_func])
window[tag_item_return_func](tag_item_list);}
gtag.setNewLineToBRTag=function(str){var breakTag='<br />';return(str+'').replace(/([^>\r\n]?)(\r\n|\n\r|\r|\n)/g,'$1'+breakTag+'$2');}
gtag.openUrl=function(url){if(DeviceUtil.isMobileWeb()){if(MobileUtil.isShoppingApp())
MobileUtil.pushPopup(url);else
window.open(url);}else{window.open(url);}}
gtag.getNormalStrByTagStr=function(tag_str){var return_str="";try{var tag_boxs_obj=JSON.parse(tag_str);if(tag_boxs_obj!=undefined&&tag_boxs_obj!=null&&tag_boxs_obj.length>0){for(var i=0;i<tag_boxs_obj.length;i++){var t_obj=JSON.parse(tag_boxs_obj[i].tagboxs[0].tagbox);return_str+='<img src="'+t_obj.img_url+'" alt="" />';return_str+=t_obj.comment+"<br />";}}}catch(e){return_str=tag_str;}
return return_str;}
gtag.getPriceStr=function(money,currency_cd){return PriceUtil.FormatCurrencyCode(ExchangeUtil.CalculateExchangeRate(money,GMKT.ServiceInfo.currencyCode,currency_cd),currency_cd);}
gtag.hideTag=function(obj,target_obj_id){obj.attr("onclick",'gtag.showTag($(this), \''+target_obj_id+'\'); return false;');obj.html(MultiLang.findCommonResource("Control/Module/TagControl.ascx","gtag_Show_Tag"));obj.removeClass("hid");var target_obj=$("#"+target_obj_id+" .tag");target_obj.animate({opacity:0},300,'swing');}
gtag.showTag=function(obj,target_obj_id){obj.attr("onclick",'gtag.hideTag($(this), \''+target_obj_id+'\'); return false;');obj.html(MultiLang.findCommonResource("Control/Module/TagControl.ascx","gtag_Hide_Tag"));obj.addClass("hid");var target_obj=$("#"+target_obj_id+" .tag");target_obj.animate({opacity:1},300,'swing');}
gtag.touch={top:0,left:0,dragx:true,dragy:true,stop:function(ui,val){var tagno=$(ui).attr("tagno");var obj_id=$(ui).attr("objid");if(obj_id!=undefined&&obj_id!=null&&obj_id!=""&&gtag.id!=obj_id)
gtag.reset(obj_id);var pointer_x=val.last_position.x;var pointer_y=gtag.max_height-(-val.last_position.y);if(pointer_x<0&&pointer_y<0){gtouch.translate($(ui),0,-gtag.max_height,'200ms',"",false);this.top=0;this.left=0;}else if(pointer_x>gtag.max_left&&pointer_y<0){gtouch.translate($(ui),gtag.max_left,-gtag.max_height,'200ms',"",false);this.top=0;this.left=gtag.max_left;}else if(pointer_x>gtag.max_left&&pointer_y>gtag.max_top){gtouch.translate($(ui),gtag.max_left,-gtag.tag_locate_limit,'200ms',"",false);this.top=gtag.max_top;this.left=gtag.max_left;}else if(pointer_x<0&&pointer_y>gtag.max_top){gtouch.translate($(ui),0,-gtag.tag_locate_limit,'200ms',"",false);this.top=gtag.max_top;this.left=0;}else if(pointer_x<0){gtouch.translate($(ui),0,(-gtag.max_height+pointer_y),'200ms',"",false);this.top=pointer_y;this.left=0;}else if(pointer_y<0){gtouch.translate($(ui),pointer_x,-gtag.max_height,'200ms',"",false);this.top=0;this.left=pointer_x;}else if(pointer_x>gtag.max_left){gtouch.translate($(ui),gtag.max_left,(-gtag.max_height+pointer_y),'200ms',"",false);this.top=pointer_y;this.left=gtag.max_left;}else if(pointer_y>gtag.max_top){gtouch.translate($(ui),pointer_x,-gtag.tag_locate_limit,'200ms',"",false);this.top=gtag.max_top;this.left=pointer_x;}else{this.top=pointer_y;this.left=pointer_x;}
$("#"+gtag.id+"_"+tagno+"_pos_x").val(this.left);$("#"+gtag.id+"_"+tagno+"_pos_y").val(this.top);}};gtag.drag={top:0,left:0,stop:function(e,ui){var tagno=$(this).attr("tagno");var obj_id=$(this).attr("objid");if(obj_id!=undefined&&obj_id!=null&&obj_id!=""&&gtag.id!=obj_id)
gtag.reset(obj_id);var pointer_x=ui.position.left;var pointer_y=ui.position.top;if(pointer_x<0&&pointer_y<0){$(this).animate({top:0,left:0},150,'swing');this.top=0;this.left=0;}else if(pointer_x>gtag.max_left&&pointer_y<0){$(this).animate({top:0,left:gtag.max_left},150,'swing');this.top=0;this.left=gtag.max_left;}else if(pointer_x>gtag.max_left&&pointer_y>gtag.max_top){$(this).animate({top:gtag.max_top,left:gtag.max_left},150,'swing');this.top=gtag.max_top;this.left=gtag.max_left;}else if(pointer_x<0&&pointer_y>gtag.max_top){$(this).animate({top:gtag.max_top,left:0},150,'swing');this.top=gtag.max_top;this.left=0;}else if(pointer_x<0){$(this).animate({top:pointer_y,left:0},150,'swing');this.top=pointer_y;this.left=0;}else if(pointer_y<0){$(this).animate({top:0,left:pointer_x},150,'swing');this.top=0;this.left=pointer_x;}else if(pointer_x>gtag.max_left){$(this).animate({left:gtag.max_left},150,'swing');this.top=pointer_y;this.left=gtag.max_left;}else if(pointer_y>gtag.max_top){$(this).animate({top:gtag.max_top},150,'swing');this.top=gtag.max_top;this.left=pointer_x;}else{this.top=pointer_y;this.left=pointer_x;}
$("#"+gtag.id+"_"+tagno+"_pos_x").val(this.left);$("#"+gtag.id+"_"+tagno+"_pos_y").val(this.top);$("#"+gtag.id+"_"+tagno+"_tag_div").css("width","");$("#"+gtag.id+"_"+tagno+"_tag_div").css("height","");}};