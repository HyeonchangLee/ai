// (c)2021 eBay Japan

var email_max_length=50;function onPageLoad(){if(window.giosis&&window.giosis.setNavigationType){window.giosis.setNavigationType("P");}
if(window.MobileUtil&&MobileUtil.isIOSApp()){$("#confirm_mobile_number").attr("pattern","[0-9]*");$("#confirm_mobile_number").attr("inputmode","numeric");}}
$(window).bind({"pageshow":function(e){if(window.giosis&&window.giosis.setNavigationType){window.giosis.setNavigationType("P");}
if($("#cust_memberkind").val()=="N"){$("#confirm_email").removeAttr("autocomplete");$("#confirm_email").val($("#cust_email").val());$("#sel_mobile_nation").val($("#cust_mobilenation").val());$("#confirm_mobile_number").val($("#cust_hpno").val());}
Util.setCookie("isOverTimer",null);ConfirmObject.type=Util.getCookie("confirm_type");if(ConfirmObject.type!=null&&ConfirmObject.type!=undefined&&ConfirmObject.type!=""&&ConfirmObject.type!="null"){ConfirmObject.changeAuthForm(ConfirmObject.type);}
else{if($("#cust_memberkind").val()=="N"){ConfirmObject.changeAuthForm("E");}}}});$(document).click(function(){$("#div_email_domain_list").removeClass("active");});$("#confirm_email").keyup(function(e){if($(this).val().indexOf("@")>=0&&$(this).val().split("@")[0]!=""){var ed_id=$(this).val().split("@")[0];var ed_domain=$(this).val().split("@")[1];var is_hide=true;$("#div_email_domain_list ul li").each(function(index){var ed=$(this).html();if($(this).attr("email_domain").startsWith("@"+ed_domain,ed_domain.length)){is_hide=false;$(this).show();}else
$(this).hide();$(this).html(ed.replace($(this).html().split("@")[0],ed_id));});if(is_hide)
$("#div_email_domain_list").hide();clearTimeout(ConfirmObject.isSetTimeOut);ConfirmObject.checkedEmailFormat(this);ConfirmObject.setEmailDomainList();}else if($(this).val()==""){ConfirmObject.initEmailForm();$("#div_email_domain_list").removeClass("active");}
if(e.keyCode==13)
$("#div_email_domain_list").removeClass("active");});$("#confirm_email").focus(function(e){if(typeof($("#confirm_email").attr("autocomplete"))=="undefined"){$("#confirm_email").attr("autocomplete","off");}
if($(this).val().indexOf("@")>=0&&$(this).val().split("@")[0]!=""){$("#div_email_domain_list").addClass("active");}});$("#confirm_mobile_number").keyup(function(e){var check_length=(ConfirmObject.mobileNation=="HK"||ConfirmObject.mobileNation=="SG")?8:10;var check_val=$("#confirm_mobile_number").val();check_val=check_val.replace(/[^\d]/g,"");if(check_val.length>=check_length){if(ConfirmObject.mobileNation=="HK"||ConfirmObject.mobileNation=="SG"){check_val=check_val.replace(/(^[0-9]{4})([0-9]{4})/,"$1-$2");}else{check_val=check_val.replace(/(^[0-9]{3})([0-9]{4})([0-9]*)/,"$1-$2-$3");}
$("#confirm_mobile_number").val(check_val);}
if((ConfirmObject.mobileNation!="HK"&&ConfirmObject.mobileNation!="SG"&&check_val.length>=check_length)||((ConfirmObject.mobileNation=="HK"||ConfirmObject.mobileNation=="SG")&&check_val.length>=check_length))
$("#btn_send_confirm_mail").removeAttr("disabled");else
$("#btn_send_confirm_mail").attr("disabled",true);if(ConfirmObject.isChangeNation)
ConfirmObject.isChangeNation=false;ConfirmObject.checkedMobileFormat(check_val);});var ConfirmObject={type:"E",step:1,regExp:/^([\.0-9a-zA-Z_-]+)@([0-9a-zA-Z_-]+)(\.[0-9a-zA-Z_-]+){1,6}$/,isCheckEmail:false,isCheckMobile:false,isSetTimeOut:null,isChangeNation:false,domainLink:"https://www.google.com",tempMobileNumber:"",mobileNation:"JP",confirm_value:"",initProperties:function(){if($("#cust_memberkind").val()!="N"){$("#confirm_email").val("");}
this.type="E";this.step=1;this.regExp=/^([\.0-9a-zA-Z_-]+)@([0-9a-zA-Z_-]+)(\.[0-9a-zA-Z_-]+){1,6}$/;this.isSetTimeOut=null;this.domainLink="https://www.google.com";this.initEmailForm();},initEmailForm:function(){$("#btn_send_confirm_mail").attr("disabled",true);$("#div_validation").hide();$("#email_validate_msg").hide();$("#result_area").hide();if($("#cust_memberkind").val()!="N"){$("#confirm_email").val("");}
$("#confirm_area").show();$("#btn_send_confirm_mail").html(MultiLang.findCommonResource("Mobile/Member/AuthenticationEmailandMobile.aspx","Verify with Email"));$("#btn_send_confirm_mail").attr("onclick","if (window.ConfirmObject.duplicateEmail) ConfirmObject.duplicateEmail();");this.isCheckEmail=false;},initMobileForm:function(){$("#btn_send_confirm_mail").attr("disabled",true);},checkedEmailFormat:function(check_obj){var check_val=$(check_obj).val();if(this.regExp.test(check_val)&&check_val.indexOf(".@")<0){$("#btn_send_confirm_mail").removeAttr("disabled");$("#div_validation").hide();this.isCheckEmail=true;}else{$("#btn_send_confirm_mail").attr("disabled",true);if(check_val==""){$("#div_validation").hide();$("#email_validate_msg").hide();}else{$("#div_validation").show();$("#email_validate_msg").show();}
this.isCheckEmail=false;}},checkedMobileFormat:function(check_val){if((this.mobileNation!="HK"&&this.mobileNation!="SG"&&check_val.replace("-","").length>=10)||(this.mobileNation=="HK"&&check_val.replace("-","").length==8)||(this.mobileNation=="SG"&&check_val.replace("-","").length==8)){check_val=check_val.replace(/(^[0-9]{3})([0-9]{4})([0-9]*)/,"$1-$2-$3");$("#confirm_mobile_number").val(check_val);if(!this.isChangeNation){$("#div_validation").hide();$("#mobile_validate_msg").hide();}
this.isCheckMobile=true;}else if(check_val==""||check_val==undefined||check_val==null){$("#div_validation").hide();$("#mobile_validate_msg").hide();this.isCheckMobile=false;}else{if(!this.isChangeNation){$("#div_validation").show();$("#mobile_validate_msg").show();}
this.isCheckMobile=false;}},changeAuthForm:function(change_type){if(change_type=="H"){this.initEmailForm();this.type="H";if($("#cust_memberkind").val()!="N"){$("#confirm_mobile_number").val("");}
$("#auth_email_area").hide();$("#auth_mobile_area").show();$("#btn_send_confirm_mail").attr("onclick","if (window.ConfirmObject.sendSMS) ConfirmObject.sendSMS();").attr("disabled",true).html(MultiLang.findCommonResource("Mobile/Member/AuthenticationEmailandMobile.aspx","Verify with Phone"));$("#btn_change_auth_type").attr("onclick","if (window.ConfirmObject.changeAuthForm) ConfirmObject.changeAuthForm('E');").html(MultiLang.findCommonResource("Mobile/Member/AuthenticationEmailandMobile.aspx","Verify with Email"));this.isCheckEmail=false;if($("#cust_memberkind").val()=="N"){$("#confirm_mobile_number").keyup();}}else{this.type="E";if($("#cust_memberkind").val()!="N"){$("#confirm_mobile_number").val("");}
$("#auth_email_area").show();$("#auth_mobile_area").hide();$("#btn_send_confirm_mail").attr("onclick","if (window.ConfirmObject.duplicateEmail) ConfirmObject.duplicateEmail();").attr("disabled",true).html(MultiLang.findCommonResource("Mobile/Member/AuthenticationEmailandMobile.aspx","Verify with Email"));$("#btn_change_auth_type").attr("onclick","if (window.ConfirmObject) ConfirmObject.changeAuthForm('H');").html(MultiLang.findCommonResource("Mobile/Member/AuthenticationEmailandMobile.aspx","Verify with Phone"));this.isCheckMobile=false;if($("#cust_memberkind").val()=="N"){ConfirmObject.checkedEmailFormat($("#confirm_email"));}}
$("#div_validation, #div_validation p").hide();Util.setCookie("confirm_type",this.type);},changeMobileNation:function(){this.mobileNation=$("#sel_mobile_nation option:selected").attr("nation_cd");this.isChangeNation=true;this.checkedMobileFormat($("#confirm_mobile_number").val());$("#confirm_mobile_number").val("");$("#btn_send_confirm_mail").attr("disabled",true);if($("#sel_mobile_nation").val()=="852"||$("#sel_mobile_nation").val()=="65"){$("#confirm_mobile_number").attr("maxlength","9")}else{$("#confirm_mobile_number").attr("maxlength","13")}},setEmailDomainList:function(){if($("#div_email_domain_list").hasClass("active")){ConfirmObject.isSetTimeOut=setTimeout(function(){$("#div_email_domain_list").removeClass("active");},5000);}else{$("#div_email_domain_list").addClass("active");ConfirmObject.isSetTimeOut=setTimeout(function(){$("#div_email_domain_list").removeClass("active");},5000);}},selectInputEmailDomain:function(obj){var select_domain=$(obj).attr("email_domain");var email_id=$("#confirm_email").val().split("@")[0];var full_email=email_id+select_domain;if(full_email.length>email_max_length){var split_cnt=email_max_length-select_domain.length;email_id=email_id.substr(0,split_cnt);full_email=email_id+select_domain;}
$("#confirm_email").val(full_email);$("#div_email_domain_list").removeClass("active");this.domainLink=$(obj).attr("email_link");this.checkedEmailFormat($("#confirm_email"));},duplicateEmail:function(obj){var email=$("#confirm_email").val();ConfirmObject.checkedEmailFormat($("#confirm_email"));if(this.isCheckEmail){var param=new RMSParam();param.add("email",email);var result=RMSHelper.callWebMethod(Public.getServiceUrl("swe_MemberAjaxService.asmx"),"CheckExistsMemberEMail",param.toJson());if(result.ResultCode==0){var email_param=new RMSParam();email_param.add("email",email);RMSHelper.asyncCallWebMethod("","EncryptEmail",email_param.toJson(),function(result,svc,methodName,xmlHttpasync){if(result!=null&&result!=""){$("#confirm_type").val("E");$("#confirm_value").val(result);$("#match_email").html(email);$("#match_popup").show();}else{alert("Error");return;}});}else if(result.ResultCode==-2||result.ResultCode==-9){alert(MultiLang.findResource("This email is already existed. Please go to login page._br/_You need to register another email for a"));}else if(result.ResultCode==-5){alert(MultiLang.findResource("checkemail_error_dup_dropout"));}else if(result.ResultCode==-10){alert(MultiLang.findResource("Free E-mail cannot be used for sign-up. Please try with another email."));}else{alert(MultiLang.findResource("You haven’t done with verification yet. Please check the verification mail first."));}}else{alert(MultiLang.findResource("This email is incorrect."));return;}},sendEmail:function(){var email=$("#confirm_email").val();var email_param=new RMSParam();email_param.add("email",email);RMSHelper.asyncCallWebMethod("","RegisterSendEmail",email_param.toJson(),function(result,svc,methodName,xmlHttpasync){if(result.ResultCode==0){$("#match_popup").hide();$("#valid_key").val(result.ResultMsg);Util.submitServerForm(Public.getMobileServerUrl("/Member/AuthenticationResult.aspx"));}else{alert("Error ["+result+"]");}});},sendSMS:function(){var reg_mobile_no=$("#confirm_mobile_number").val().replace(/[-]/g,"");var contact_no="";if("RU".indexOf(this.mobileNation)>=0)
contact_no=$("#confirm_mobile_number").val().replace(/(^[0-9]{5})([0-9]{4})([0-9]*)/,"$1-$2-$3");else if("JP.KR.MY.CN".indexOf(this.mobileNation)>=0)
contact_no=$("#confirm_mobile_number").val().replace(/(^[0-9]{3})([0-9]{4})([0-9]*)/,"$1-$2-$3");else if("SG.HK".indexOf(this.mobileNation)>=0)
contact_no=$("#confirm_mobile_number").val().replace(/(^[0-9]{4})([0-9]{4})/,"$1-$2");else
contact_no=$("#confirm_mobile_number").val().replace(/(^[0-9]{4})([0-9]{4})([0-9]*)/,"$1-$2-$3");if(("JP.KR".indexOf(this.mobileNation)>=0&&reg_mobile_no.length>=12)||("JP.KR".indexOf(this.mobileNation)<0&&reg_mobile_no.length>=15)){alert(MultiLang.findResource("Please put the correct phone number."));return;}
if(this.isCheckMobile){var select_nation_code=$("#sel_mobile_nation option:selected").val();var check_mobile_no="";var result;if(select_nation_code!=null&&select_nation_code!=undefined&&select_nation_code!=""&&reg_mobile_no!=null&&reg_mobile_no!=undefined&&reg_mobile_no!="")
check_mobile_no="+"+select_nation_code+"-"+reg_mobile_no;else
alert("Mobile Error");if(check_mobile_no!=""){var param=new RMSParam();param.add("hp_no",check_mobile_no);result=RMSHelper.callWebMethod(Public.getServiceUrl("swe_MemberAjaxService.asmx"),"CheckExistsRegisterHpNo",param.toJson());var contact_no_result=RMSHelper.dynamic.executeToDataTable("Member.CheckRegisterMemberByHpNo",RMSParam.create().add("register_hp_no",("+"+select_nation_code+"-"+contact_no)));if(result!=null&&result!=undefined&&result!=""){if(result.ResultCode<0){alert(MultiLang.findResource("This number is successfully verified. In case you haven’t made verification with this number, please"));return;}}else{alert("Error");return;}
if(contact_no_result.OutputData.Return<0){alert(MultiLang.findResource("This number is successfully verified. In case you haven’t made verification with this number, please"));return;}
var send_param=new RMSParam();send_param.add("hp_no",check_mobile_no);send_param.add("channel",$("#channel").val());var send_result=RMSHelper.callWebMethod(Public.getServiceUrl("swe_MemberAjaxService.asmx"),"MemberConfirmCodeSendRegisterHpNo",send_param.toJson());if(send_result.ResultCode>=0){$("#confirm_type").val("H");$("#confirm_value").val(check_mobile_no);$("#seq_no").val(send_result.ResultObject.seq_no);Util.submitServerForm(Public.getMobileServerUrl("/Member/AuthenticationResult.aspx"));}else if(send_result.ResultCode==-11){alert(MultiLang.findResource("The SMS has reached its verification limit. Please try again after a while."));return;}}}else{alert(MultiLang.findResource("Please put the correct phone number."));}}}