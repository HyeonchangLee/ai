// (c)2021 eBay Japan

var _debug=false;function toggleDebug(){_debug=!_debug;console.log('[debug mode] '+_debug);}
Array.prototype.addItem=function(_value){var _idx=this.findIndex(function(element){return element==_value;});if(_idx==-1)
this.push(_value);else
this[_idx]=_value;return this;}
Array.prototype.removeItem=function(_value){var _idx=this.findIndex(function(element){return element==_value;});if(_idx>=0)
this.remove(_idx);return this;}
Array.prototype.containItem=function(_value){var _idx=this.findIndex(function(element){return element==_value;});if(_idx>=0)
return true;else
return false;}
var FilterTabID={sort:"0",free_shipping:"1",official_shop:"2",price:"3",category:"4",review_score:"5",brand:"6",shipping_from:"7",region:"8",goods_view_type:"9",search_subkeyword:"10",filter_toggle:"11"};var MobileFilterUI=function(options){var useFilterKind=new Array();var renderCnt=0;var selectedBrandTab='0';var selectedBrandTab_Keyword='';var _handle_BrandUpdate=null;var flag_more_brand=true;var flag_more_category=true;var flag_more_region=true;var flag_hidden_region=false;var flag_reset=false;var flag_preview=false;var flag_toastmsg_show=true;var filtered_item_count=0;var last_customPriceInputIdx=1;var selectFilterValue={param_group_cd:0,param_gdlc_cd:"",param_gdmc_cd:"",param_gdsc_cd:"",param_region_large_cd:"",param_region_medium_cd:"",param_region_small_cd:"",param_free_shipping_search_yn:"N",param_official_shop:"N",param_promotion_yn:"N",param_ship_from_nation_cds:[],param_brand_nos:[],param_review_score:"",param_price_range:{currentMin:0,currentMax:0},param_search_keyword:"",param_search_in_result:[]};var setting={isAllPopupSubmit:false,selectedFilters_selector:"#filter_selectedlist ul li button.removeBtn",toggle_selector:"#btn_promotion_toggle",cate_tree_selector:"#div_filter_category",shipping_tree_selector:"#div_filter_shipping",brand_tree_selector:"#div_filter_brand",shipping_from_tree_selector:"#div_filter_shipping_from",region_tree_selector:"#div_filter_region",total_item_count:0,search_keyword:"",search_in_result:[],price_range:{currentMin:0,currentMax:0},category:{group_cd:"",gdlc_cd:"",gdmc_cd:"",gdsc_cd:"",category_view_depth:0},region:{region_large_cd:"",region_medium_cd:"",region_small_cd:""},brand_nos:[],review_score:"",target_currency:'',shipping:{free:false},official_shop:"",ship_from_nation_cds:[],promotion_yn:'',visible:{category:true,region:true},visible_count:{category:6,region:6,brand:30,brand_all:10},datas:{filters:typeof enable_filter_items_json=="undefined"?[]:enable_filter_items_json,categories:typeof default_category_json==="undefined"?[]:default_category_json,regions:typeof default_region_json==="undefined"?[]:default_region_json,brands:typeof default_brand_json=="undefined"?[]:default_brand_json,shipping:{free:true},shipping_froms:[]},callback:{init:function(options){},openFilterClick:function(options){},sortClick:function(sort_type){},categoryClick:function(div_filter_category,category_cd,category_kind,selected,obj,selectedFilterValue,e){},regionClick:function(div_filter_region,region_cd,region_kind,selected,obj,selectedFilterValue,e){},shippingClick:function(div_filter_shipping,shipping_cd,selected,obj,e){},brandClick:function(div_filter_brand,all_brand_nos,now_brand_no,selected,obj,e){},shippingFromClick:function(div_filter_shipping_from,all_shipping_from_cds,shipping_from_cd,selected,obj,e){},goodsviewtypeClick:function(goodsviewtype){},toggleClick:function(btn_promotion_toggle,obj,e){},reset:function(default_settings,selectFilterValue){},apply:function(parameters,selectFilterValue){},clear:function(default_settings,selectFilterValue){},previewResult:function(parameters,selectFilterValue){}},settingToParams:function(){selectFilterValue.param_group_cd=setting.category.group_cd;selectFilterValue.param_gdlc_cd=setting.category.gdlc_cd;selectFilterValue.param_gdmc_cd=setting.category.gdmc_cd;selectFilterValue.param_gdsc_cd=setting.category.gdsc_cd;selectFilterValue.param_region_large_cd=setting.region.region_large_cd;selectFilterValue.param_region_medium_cd=setting.region.region_medium_cd;selectFilterValue.param_region_small_cd=setting.region.region_small_cd;selectFilterValue.param_free_shipping_search_yn=setting.shipping.free?"Y":"N";selectFilterValue.param_official_shop=setting.official_shop;selectFilterValue.param_promotion_yn=setting.promotion_yn;selectFilterValue.param_brand_nos=setting.brand_nos;selectFilterValue.param_price_range=setting.price_range;selectFilterValue.param_search_keyword=setting.search_keyword;selectFilterValue.param_search_in_result=setting.search_in_result;selectFilterValue.param_ship_from_nation_cds=setting.ship_from_nation_cds;selectFilterValue.param_review_score=setting.review_score;},paramsToSetting:function(){setting.category.group_cd=selectFilterValue.param_group_cd;setting.category.gdlc_cd=selectFilterValue.param_gdlc_cd;setting.category.gdmc_cd=selectFilterValue.param_gdmc_cd;setting.category.gdsc_cd=selectFilterValue.param_gdsc_cd;setting.region.region_large_cd=selectFilterValue.param_region_large_cd;setting.region.region_medium_cd=selectFilterValue.param_region_medium_cd;setting.region.region_small_cd=selectFilterValue.param_region_small_cd;setting.shipping.free=selectFilterValue.param_free_shipping_search_yn.toLowerCase()=="y";setting.param_official_shop=selectFilterValue.param_official_shop;setting.promotion_yn=selectFilterValue.param_promotion_yn;setting.brand_nos=selectFilterValue.param_brand_nos;setting.price_range=selectFilterValue.param_price_range;setting.search_keyword=selectFilterValue.param_search_keyword;setting.search_in_result=selectFilterValue.param_search_in_result;setting.ship_from_nation_cds=selectFilterValue.param_ship_from_nation_cds;setting.review_score=selectFilterValue.param_review_score;},toShippingFromFormat:function(){var _shippings=[];var tmp;for(var i=0;i<setting.datas.shipping_froms.length;i++){tmp=setting.datas.shipping_froms[i];_shippings.push({name:tmp.CategoryName,shipping_from_cd:tmp.CategoryCode,count:tmp.ResultCount});}
return _shippings;},getResource:function(resID){var categoryid="mobile/common/control/search/uisearchfilterorder.ascx";var _value=MultiLang.findCommonResource(categoryid,resID);return typeof _value==="undefined"?"":_value;}};setOptions(options);if(setting.target_currency=="")
setting.target_currency=GMKT.ServiceInfo.currencyCode;var default_settings=$.extend(true,{},setting);setting.settingToParams();var cate_tree=$(setting.cate_tree_selector);var brand_tree=$(setting.brand_tree_selector);var shipping_from_tree=$(setting.shipping_from_tree_selector);var region_tree=$(setting.region_tree_selector);if(setting.total_item_count<11){if($("#btn_promotion_toggle").length>0)
$("#btn_promotion_toggle").css({visibility:'hidden'});$("#div_search_filter").hide();}
if(setting.total_item_count==0)
$("#btn_filter_clear").hide();Init();initEventBind();initEventBindAllPopup();initDataEventBind();initEventTrigger();setting.callback.init(setting);$(document).ready(function(){if(setting.promotion_yn=="Y"){selectFilterValue.param_promotion_yn="Y";}
if(typeof v_filter_eventtagflag!="undefined"&&v_filter_eventtagflag=="Y"){$(document).on("click","#layerpopup_filterMenu button[ga=true], #filter_free_shipping[ga=true],#filter_official_shop[ga=true], #layerpopup_filterMenu input[ga=true]",function(e,isInitTrigger){if(e.target.classList.contains('active')||e.target.classList.contains('selected'))return;if(_debug)console.log('[CLICK] GA Event');UITrackingHelper.use_console=_debug;UITrackingHelper.FireGA360HtmlAttribute(this);});}
if(Util.getCookie("filter_load_popup_yn")=='Y'){window.setTimeout(function(){$('#filter_allPopup').trigger('click');},200);Util.setCookie("filter_load_popup_yn",'N');}});function setFilter(filterName,isAdd){var _add=true;if(typeof isAdd==="boolean"){_add=isAdd;}
if(_add){useFilterKind.addItem(filterName);}
else{useFilterKind.removeItem(filterName);}}
function setOptions(options){if(options){if(typeof options.datas==="object"){if(typeof options.datas.brands==="object")
setting.datas.brands=null;if(typeof options.datas.categories==="object")
setting.datas.categories=null;if(typeof options.datas.shipping_froms==="object")
setting.datas.shipping_froms=null;}
$.extend(true,setting,options);}}
function _isShowAllPopup(){return $('#layerpopup_filterAll').hasClass('selected');}
function _isSelected(obj){var selected=true;if(!$(obj).hasClass("selected")){selected=false;}
return selected;}
function _isParentSelected(obj){var selected=true;if(!$(obj).parent().hasClass("selected")){selected=false;}
return selected;return selected;}
function _isEnableFilter(filtertab){return setting.datas.filters.containItem(filtertab);}
function getInitTriggerValue(isInitTrigger){if(typeof isInitTrigger==="undefined")
return false;else
return isInitTrigger;}
function getDataCode(obj){var val='';if(typeof obj!="undefined"&&obj!=null&&obj.getAttribute("data-code"))
val=obj.getAttribute("data-code");return val;}
function getFilterParameter(search_type){var params="";params="keyword="+encodeURIComponent(selectFilterValue.param_search_keyword);params+="&group_code="+selectFilterValue.param_group_cd;params+="&gdlc_cd="+selectFilterValue.param_gdlc_cd;params+="&gdmc_cd="+selectFilterValue.param_gdmc_cd;params+="&gdsc_cd="+selectFilterValue.param_gdsc_cd;params+="&region_large_cd="+selectFilterValue.param_region_large_cd;params+="&region_medium_cd="+selectFilterValue.param_region_medium_cd;params+="&region_small_cd="+selectFilterValue.param_region_small_cd;params+="&brand_no="+selectFilterValue.param_brand_nos.join(",");params+="&free_shipping_search_yn="+selectFilterValue.param_free_shipping_search_yn;params+="&official_shop="+selectFilterValue.param_official_shop;params+="&promotion_yn="+selectFilterValue.param_promotion_yn;params+="&min_price="+selectFilterValue.param_price_range.currentMin;params+="&max_price="+selectFilterValue.param_price_range.currentMax;params+="&ship_from_nation_cd="+selectFilterValue.param_ship_from_nation_cds.join(",");params+="&additional_keyword="+encodeURIComponent(selectFilterValue.param_search_in_result.join(" "));params+="&review_score="+selectFilterValue.param_review_score;if(_isShowAllPopup()&&flag_preview==true)
params+="&onlytotalcount=Y";if(_debug)console.log('[ getFilterParameter ] ['+search_type+']\n'+params.replace(/\&/g,'\t\n\&'));return params;}
function getFilterCount(){var filter_list=$(setting.selectedFilters_selector);var filter_Cnt=filter_list.length;return filter_Cnt;}
function getFilterValue(){if(_debug)console.log('[ getFilterValue ] ');var filter_list=$(setting.selectedFilters_selector);var filter_Cnt=filter_list.length;if(_debug)console.log('Filter Count: '+filter_Cnt)
setting=$.extend(true,{},default_settings);setting.settingToParams();selectFilterValue.param_promotion_yn=_isSelected($(setting.toggle_selector))?'Y':'N';for(var i=0;i<filter_Cnt;i++){var filterItem=$(filter_list[i]);var filtertab=filterItem.attr('data-filtertab');var dataCode=filterItem.attr('data-code');if(typeof dataCode=="undefined")continue;dataCode=dataCode.trim();if(_debug)console.log(i+'. filtertab: '+filtertab+', code: '+dataCode);switch(filtertab){case FilterTabID.free_shipping:selectFilterValue.param_free_shipping_search_yn=dataCode;break;case FilterTabID.official_shop:selectFilterValue.param_official_shop=dataCode;break;case FilterTabID.price:var revision_minPrice=0;var revision_maxPrice=0;if('/LOWESTPRICE/'.indexOf(v_filter_displaypage)==-1){if(dataCode.indexOf('(')>-1)revision_minPrice=-1;if(dataCode.indexOf(')')>-1)revision_maxPrice=-1;}
dataCode=dataCode.replace(/[\[\]\(\)]/g,'');var sep=dataCode.split(',');if(sep.length>0)
selectFilterValue.param_price_range.currentMin=(sep[0]==''?0:parseInt(sep[0])+revision_minPrice);if(sep.length>1)
selectFilterValue.param_price_range.currentMax=(sep[1]==''?999999999:parseInt(sep[1])+revision_maxPrice);break;case FilterTabID.review_score:selectFilterValue.param_review_score=dataCode;break;case FilterTabID.shipping_from:selectFilterValue.param_ship_from_nation_cds.addItem(dataCode);break;case FilterTabID.brand:selectFilterValue.param_brand_nos.addItem(dataCode);break;case FilterTabID.category:var sep=dataCode.split(':')
var category_kind=sep[0];var category_cd=sep[1];switch(category_kind){case"L":selectFilterValue.param_gdlc_cd=category_cd;selectFilterValue.param_gdmc_cd="";selectFilterValue.param_gdsc_cd="";break;case"M":var _gdmcObj=getCategoryInfo(category_cd);selectFilterValue.param_gdlc_cd=(_gdmcObj?_gdmcObj.ParentCategoryCode:'');selectFilterValue.param_gdmc_cd=category_cd;selectFilterValue.param_gdsc_cd="";break;case"S":var _gdscObj=getCategoryInfo(category_cd);var _gdmcObj=null;_gdmcObj=_gdscObj?getCategoryInfo(_gdscObj.ParentCategoryCode):null;selectFilterValue.param_gdlc_cd=(_gdmcObj?_gdmcObj.ParentCategoryCode:'');selectFilterValue.param_gdmc_cd=_gdscObj.ParentCategoryCode;selectFilterValue.param_gdsc_cd=category_cd;break;}
break;case FilterTabID.search_subkeyword:selectFilterValue.param_search_in_result=[];selectFilterValue.param_search_in_result.addItem(dataCode);break;case FilterTabID.region:var sep=dataCode.split(':')
var region_kind=sep[0];var region_cd=sep[1];switch(region_kind){case"L":selectFilterValue.param_region_large_cd=region_cd;selectFilterValue.param_region_medium_cd="";selectFilterValue.param_region_small_cd="";break;case"M":var _regionLargeObj=getRegionInfo(region_cd);selectFilterValue.param_region_large_cd=(_regionLargeObj?_regionLargeObj.ParentCategoryCode:'');selectFilterValue.param_region_medium_cd=region_cd;selectFilterValue.param_region_small_cd="";break;case"S":var _regionSmallObj=getRegionInfo(region_cd);var _regionMediumObj=null;_regionMediumObj=_regionSmallObj?getRegionInfo(_regionSmallObj.ParentCategoryCode):null;selectFilterValue.param_region_large_cd=(_regionMediumObj?_regionMediumObj.ParentCategoryCode:'');selectFilterValue.param_region_medium_cd=_regionSmallObj.ParentCategoryCode;selectFilterValue.param_region_small_cd=region_cd;break;}
break;}}
if(_debug)console.log('-------------------------------');return selectFilterValue;}
function reset(fireCallback){if(_debug)console.log('reset: '+fireCallback);$('#searchfilterMenuFilter').val('');$('#filterDetailPriceNumfilterMenu1').val('');$('#filterDetailPriceNumfilterMenu2').val('');categoryNavClick(0);regionNavClick(0);if(flag_hidden_region==true&&v_filter_displaypage!="FURUSATO_SRP"){setRegionFilterVisible(false);}
if($('#filter_brand').length>0){window.setTimeout(function(){selectFilterValue.param_brand_nos=[];UpdateBrandList(selectedBrandTab,'');$('.brandList li input[type=checkbox].selected').removeClass('selected');var checkbrandlist=$('.brandList li input[type=checkbox]:checked');if(checkbrandlist!=undefined&&checkbrandlist!=null)
checkbrandlist.prop('checked',false);},200);}
setting=$.extend(true,{},default_settings);setting.settingToParams();if($("#btn_promotion_toggle").length>0&&$("#btn_promotion_toggle").hasClass("selected")){selectFilterValue.param_promotion_yn="Y";}
flag_toastmsg_show=false;if(fireCallback)
setting.callback.reset(default_settings,selectFilterValue);}
function resetAll(){if(_debug)console.log('resetAll');$('#filterDetailPriceNumfilterAll1').val('');$('#filterDetailPriceNumfilterAll2').val('');$('#detailfilterAllSearch').val('');flag_more_category=true;categoryNavClick(0);if(flag_hidden_region==true&&v_filter_displaypage!="FURUSATO_SRP"){setRegionFilterVisible(false);}
flag_more_brand=true;selectFilterValue.param_brand_nos=[];UpdateBrandList(selectedBrandTab,'');$('.brandList li input[type=checkbox].selected').removeClass('selected');var checkbrandlist=$('.brandList li input[type=checkbox]:checked');if(checkbrandlist!=undefined&&checkbrandlist!=null)
checkbrandlist.prop('checked',false);flag_more_region=true;regionNavClick(0);if(typeof is_furusato_search!="undefined"&&is_furusato_search=='Y'){if(window.MobileUtil&&MobileUtil.hideFurusatoSearchHeader&&setting.category.gdlc_cd!=""){Util.setCookie("filter_load_popup_yn","Y");MobileUtil.hideFurusatoSearchHeader({hideCallback:searchSubmit});}}
previewResult();}
function apply(isShowToastMsg){if(typeof isShowToastMsg=="undefined")isShowToastMsg=true;flag_toastmsg_show=isShowToastMsg;window.setTimeout(function(){getFilterValue();setting.callback.apply(null,selectFilterValue)},100);}
function previewResult(){if(v_limit_mode)return;if(_isShowAllPopup()==false)return;window.setTimeout(function(){getFilterValue();flag_preview=true;setting.callback.previewResult(null,selectFilterValue);window.setTimeout(function(){flag_preview=false;},200);},100);}
function Init(){filtered_item_count=setting.total_item_count;if($('#li_filter_region').css('display')=='none'){flag_hidden_region=true;}
var viewgdlist=getCookieViewGoodsListType();if(viewgdlist!=undefined&&viewgdlist!=null&&viewgdlist!=''){var sep=viewgdlist.split(',');if(sep!=null&&sep.length>0){if(sep.length>1){var list_type=sep[1];if(list_type!=undefined&&list_type!=null&&list_type!=""){$('#filter_goodsviewtype button[value]').removeClass('selected');$('#filter_goodsviewtype button[value='+list_type+']').addClass('selected');}}}}
InitBrand();if(typeof v_limit_mode!="undefined"&&v_limit_mode==true){$('#ul_search_filter_top').hide();}}
function InitBrand(){if(_debug)console.log('Init Brand');if(setting.datas.brands==null||setting.datas.brands.length<1){hideFilterMenu(FilterTabID.brand);return null;}
if($('#ul_brand').html()==undefined)return;selectedBrandTab="0";UpdateBrandList(0,'',0);}
function hideFilterMenu(filterTab){if(typeof filterTab!="undefined"){if(_debug)console.log('hideFilterMenu ('+filterTab+')');$('.filterTop button[data-filtertab='+filterTab+']').parent().hide();$('#layerpopup_filterAll div[data-filtertab='+filterTab+']').css('display','none');$('#layerpopup_filterAll div[data-filtertab='+filterTab+']').prev().css('display','none');}}
function setPreviewSearchResult(cnt){if(v_limit_mode)return;var html=''
if(cnt>=0){html='<strong>'+Util.getNumberFormat(cnt)+'</strong> ';}
if(_debug)console.log('[setPreviewSearchResult] '+cnt);$('#btnAllFilterSubmit').html(html+setting.getResource("GoodsDisplayCount"));}
function initEventBind(){$("#filter_selectedlist ul").bind('click',function(e,isInitTrigger){if(_debug)console.log('isInitTrigger:'+isInitTrigger);if(e.target.classList.contains('removeBtn')==false)return;if(_isShowAllPopup()==true)return;if(flag_reset==true)return;var filterTab=e.target.getAttribute('data-filtertab');var dataCode=e.target.getAttribute('data-code');if(filterTab==FilterTabID.category){if(getCategoryGDLC(dataCode)==v_furusato_gdlc_cd){selectFilterValue.param_gdlc_cd='';selectFilterValue.param_region_large_cd='';selectFilterValue.param_region_medium_cd='';selectFilterValue.param_region_small_cd='';if(typeof v_filter_displaypage!="undefined"&&v_filter_displaypage=="FURUSATO_SRP"){if(window.MobileUtil&&MobileUtil.hideFurusatoSearchHeader)
MobileUtil.hideFurusatoSearchHeader({hideCallback:searchSubmit});return false;}
removeFilter(FilterTabID.region);new qoo10_func.dg_layerpopup().close('#layerpopup_filterMenu');if($('#filter_category').hasClass('active'))
$('#filter_category').removeClass('active');}}
if(_debug)console.log('[click] removeBtn');if(!getInitTriggerValue(isInitTrigger))
apply(false);if(filterTab==FilterTabID.category){categoryNavClick(0);if(flag_hidden_region==true){hideFilterMenu(FilterTabID.region);}}
if(filterTab==FilterTabID.region){regionNavClick(0);}
if(filterTab==FilterTabID.brand){if(dataCode!=undefined&&dataCode!=''){$('.brandList li input[type=checkbox][data-code='+dataCode+']').removeClass('selected');}}});$("#filterPopup_sortlist li button").click(function(e){var sort_name=$(this).html();var cur_sort_name=$("#filter_sort_type").html().trim();var sort_type=$(this).attr("data-code");$("#filter_sort_type").attr('data-code',sort_type);if(sort_name!=cur_sort_name){if(sort_type.indexOf('rank_point')>=0){var loginGender=Public.getMemberKind();if(loginGender!=undefined&&loginGender!=null){if(loginGender=="M"){sort_type="RANK_POINT_MALE";}else{sort_type="RANK_POINT_FEMALE";}}else{sort_type="RANK_POINT_FEMALE";}}
setting.callback.sortClick(sort_type);return true;}
else{return false;}});$("#filter_free_shipping").click(function(e){apply();});$("#filter_official_shop").click(function(e){apply();});$("#filter_category").click(function(e){var selected_category=$(setting.selectedFilters_selector+'[data-filtertab='+FilterTabID.category+']').attr('data-code');if(selected_category==undefined||selected_category==''){flag_reset=true;categoryNavClick(0);window.setTimeout(function(){flag_reset=false;},200);}});$("#filter_region").click(function(e){var selected_region=$(setting.selectedFilters_selector+'[data-filtertab='+FilterTabID.region+']').attr('data-code');if(selected_region==undefined||selected_region==''){flag_reset=true;regionNavClick(0);window.setTimeout(function(){flag_reset=false;},200);}});$("#filter_price").click(function(e){if($(this).hasClass('active')==false){$("#filterDetailPriceNumfilterMenu1").val('');$("#filterDetailPriceNumfilterMenu2").val('');}});$("#filterPopup_Price input[name=priceRadio]").click(function(e){$("#filterDetailPriceNumfilterMenu1").val('');$("#filterDetailPriceNumfilterMenu2").val('');apply();});$('#filterDetailPriceNumfilterMenu1').bind('keyup',function(e){last_customPriceInputIdx=1;if(_debug)console.log('last_customPriceInputIdx : '+last_customPriceInputIdx);});$('#filterDetailPriceNumfilterMenu2').bind('keyup',function(e){last_customPriceInputIdx=2;if(_debug)console.log('last_customPriceInputIdx : '+last_customPriceInputIdx);});$("#btnfilterPopup_CustomPrice").click(function(e){if(e.target.classList.contains('reset')){$(this).attr('data-code','');return;}
var msgId=(last_customPriceInputIdx==1?'Msg_validate_price_greater_then_max':'Msg_validate_price_less_then_min');if(validate_InputPrice('#filterDetailPriceNumfilterMenu1','#filterDetailPriceNumfilterMenu2',msgId)==true){var beginPrice=$('#filterDetailPriceNumfilterMenu1').val();var endPrice=$('#filterDetailPriceNumfilterMenu2').val();$(this).attr('data-code','['+beginPrice+','+endPrice+')');UITrackingHelper.FireGA360HtmlAttribute(this);apply();return true;}
else{return false;}});$("#filterPopup_ReviewScore li button").click(function(e){apply();});$("#filter_goodsviewtype li button").click(function(e){var listType=$(this).val();setting.callback.goodsviewtypeClick(listType);setCookieViewGoodsListType(listType);apply(false);});$('#detailfilterMenuSearch').on('keyup',function(e){if(event.keyCode==13){$('#btnSearchSubKeywordSubmit').trigger('click');}});$("#btnSearchSubKeywordSubmit").click(function(e){var keyword=$('#detailfilterMenuSearch').val();if(keyword.trim().length>0){$('#btnSearchSubKeywordSubmit').attr('data-code',keyword);UITrackingHelper.FireGA360HtmlAttribute(this);apply();return true;}
else{return false;}});$('#filter_brand').click(function(e){if(_debug)console.log('[click] filter_brand');InitBrand();});$('.brandTab li button[data-brandtab]').bind('click',function(e){if(_debug)console.log('[click] brandTab : '+$(this).attr('data-brandtab'));if(setting.isAllPopupSubmit==true)return;var brandtab=$(this).attr('data-brandtab');selectedBrandTab=brandtab;if(brandtab=='1'||brandtab=='2'){initBrandSubFilter(brandtab);}
UpdateBrandList(brandtab,'');});$('.brandTop input[type=search]').bind('keyup',function(e){var searchBrandKeyword=this.value.trim();var isBrandSearchMode=searchBrandKeyword==''?false:true;if(isBrandSearchMode){qoo10_func.filterLayerpopupTop(document.querySelector(".searchFilterWrap .filterTop .filter ul li button.brand").getAttribute("data-filtertab"),document.querySelector(".searchFilterWrap .filterTop .filter ul li button.brand"));UpdateBrandList(9,searchBrandKeyword,100);}
else{UpdateBrandList(selectedBrandTab,selectedBrandTab_Keyword);}});$('.brandTop button.searchSubmitBtn').bind('click',function(e){event.stopPropagation();});$('.brandTop button.searchRemoveBtn').click(function(e){UpdateBrandList(selectedBrandTab,selectedBrandTab_Keyword);});$('#filter_allPopup').click(function(e){setting.isAllPopupSubmit=false;if(_debug)console.log('filter_allPopup CLICK: '+setting.isAllPopupSubmit);if(window.giosis&&window.giosis.setIsAbleRefresh)
window.giosis.setIsAbleRefresh($('#layerpopup_filterAll').hasClass('selected'));var selected_category=$(setting.selectedFilters_selector+'[data-filtertab='+FilterTabID.category+']').attr('data-code');if(selected_category==undefined||selected_category==''){categoryNavClick(0);}
var selected_region=$(setting.selectedFilters_selector+'[data-filtertab='+FilterTabID.region+']').attr('data-code');if(selected_region==undefined||selected_region==''){regionNavClick(0);}
InitBrand();var selected_priceText=$('#filterAll_Price_Selected_Text').text();if(selected_priceText!=''){if($('#layerpopup_filterAll_Price ul li input[data-value=\''+selected_priceText+'\']').length==0){var sep=selected_priceText.split('~');var minPrice=Util.safeNumber(sep[0]);var maxPrice=Util.safeNumber(sep[1]);$('#filterDetailPriceNumfilterAll1').val(minPrice);$('#filterDetailPriceNumfilterAll2').val(maxPrice);}
else{$('#filterDetailPriceNumfilterAll1').val('');$('#filterDetailPriceNumfilterAll2').val('');$('#btnfilterDetailPriceNumfilterAll').attr('data-code','');}}
else{$('#filterDetailPriceNumfilterAll1').val('');$('#filterDetailPriceNumfilterAll2').val('');$('#btnfilterDetailPriceNumfilterAll').attr('data-code','');}
if(flag_more_category==false||$('#ul_category_all .filterDetailList li').length<=setting.visible_count.category){$('#btn_categoryall_more').hide();}
else{$('#btn_categoryall_more').show();}
if(flag_more_region==false||$('#ul_region_all .filterDetailList li').length<=setting.visible_count.region){$('#btn_regionall_more').hide();}
else{$('#btn_regionall_more').show();}
setPreviewSearchResult(filtered_item_count);setting.callback.openFilterClick(setting);});$("#btn_filter_refresh").bind('click',function(e){if(_isShowAllPopup()==true)return;if(_debug)console.log('button.refreshBtn');flag_reset=true;reset(true);window.setTimeout(function(){flag_reset=false;},200);});$('#btn_filter_clear').click(function(e){if($("#btn_promotion_toggle").length>0&&$("#btn_promotion_toggle").hasClass("selected")){$("#btn_promotion_toggle").removeClass("selected");setPromotionToggleFilterUI();}
$('#btn_filter_refresh').trigger('click',false);});$("#btn_promotion_toggle").click(function(e){$(this).toggleClass('selected');setPromotionToggleFilterUI();apply(flag_toastmsg_show);});}
function initEventBindAllPopup(){$('#filter_all_free_shipping').bind('click',function(e){if(setting.isAllPopupSubmit==true)return;if(_debug)console.log('filter_all_free_shipping');previewResult();});$('#filter_all_official_shop').bind('click',function(e){if(setting.isAllPopupSubmit==true)return;if(_debug)console.log('filter_all_official_shop');previewResult();});$('#layerpopup_filterAll_Price input[name=priceRadio]').bind('click',function(e){if(_debug)console.log('[all] priceRadio Click : '+setting.isAllPopupSubmit);if(setting.isAllPopupSubmit==true)return;var selected=!_isSelected(this);if(selected){$("#filterDetailPriceNumfilterAll1").val('');$("#filterDetailPriceNumfilterAll2").val('');}
previewResult();});$('#filterDetailPriceNumfilterAll1').bind('keyup',function(e){last_customPriceInputIdx=1;if(_debug)console.log('last_customPriceInputIdx : '+last_customPriceInputIdx);});$('#filterDetailPriceNumfilterAll2').bind('keyup',function(e){last_customPriceInputIdx=2;if(_debug)console.log('last_customPriceInputIdx : '+last_customPriceInputIdx);});$("#btnfilterDetailPriceNumfilterAll").bind('click',function(e){if(setting.isAllPopupSubmit==true)return;var msgId=(last_customPriceInputIdx==1?'Msg_validate_price_greater_then_max':'Msg_validate_price_less_then_min');if(validate_InputPrice('#filterDetailPriceNumfilterAll1','#filterDetailPriceNumfilterAll2',msgId)==true){var beginPrice=$('#filterDetailPriceNumfilterAll1').val();var endPrice=$('#filterDetailPriceNumfilterAll2').val();if(beginPrice=='')beginPrice='0';if(endPrice=='')endPrice='999999999';if(e.target.classList.contains('reset')==false){$(this).attr('data-code','['+beginPrice+','+endPrice+')');}
previewResult();return true;}
else{return false;}});$("input[name=filter_review_scoreall]").click(function(e){previewResult();});$("input[name=shippingFromall]").click(function(e){previewResult();});$("#btnSearchSubKeywordSubmitall").click(function(e){var keyword=$('#detailfilterAllSearch').val();if(keyword.trim().length>0){$('#btnSearchSubKeywordSubmitall').attr('data-code',keyword);previewResult();}});$("#btnSearchSubKeywordRemoveall").click(function(e){if(setting.isAllPopupSubmit==true)return;previewResult();});$('#btn_brandall_more').bind('click',function(e){if(setting.isAllPopupSubmit==true)return;flag_more_brand=false;$('#ul_brandall li').removeClass('hidden');$(this).hide();});$('#btn_categoryall_more').bind('click',function(e){if(setting.isAllPopupSubmit==true)return;flag_more_category=false;$('#ul_category_all li').show();$(this).hide();});$('#btn_regionall_more').bind('click',function(e){if(setting.isAllPopupSubmit==true)return;flag_more_region=false;$('#ul_region_all li').show();$(this).hide();});$('#btnAllFilterSubmit').bind('click',function(e){setting.isAllPopupSubmit=true;var isShowToast=true;if(getFilterCount()==0)
isShowToast=false;apply(isShowToast);window.setTimeout(function(){if(getFilterCount()>0){var send_ga_eventtagids=[];$(setting.selectedFilters_selector+'[data-filtertab]').each(function(index,item){var filtertab=$(item).attr('data-filtertab');if(send_ga_eventtagids.containItem(filtertab)==false){var ga_label='';switch(filtertab){case"1":ga_label="popup_filter_free_shipping";break;case"2":ga_label="popup_filter_official_brand";break;case"3":ga_label="popup_filter_price";break;case"4":ga_label="popup_filter_category";break;case"5":ga_label="popup_filter_review_score";break;case"6":ga_label="popup_filter_brand";break;case"7":ga_label="popup_filter_shipping_country";break;case"8":ga_label="popup_filter_region";break;case"10":ga_label="popup_filter_keword_search";break;}
GA_Event_Call(v_filter_eventtag_category,v_filter_eventtag_action,ga_label);send_ga_eventtagids.addItem(filtertab);}});}},500);});$('#btnAllFilter_Reset').bind('touchend',function(e){window.setTimeout(function(e){resetAll();},100)});}
function initDataEventBind(){initCategoryEventBind();initRegionEventBind();initBrandEventBind();$("#ul_shippingFrom li button").bind("click",function(e,isInitTrigger){var cd=$(this).attr("data-code");if(cd=="ALL")
cd="";shippingFromClick(cd,this,e,getInitTriggerValue(isInitTrigger));});}
function initCategoryEventBind(){$(document).on("click","#ul_category button",function(e,isInitTrigger){var data_code=$(this).attr("data-code");var sep=data_code.split(':');var type=sep[0];var cd=sep[1];if(flag_hidden_region==true&&v_filter_displaypage!="FURUSATO_SRP"){if(getCategoryGDLC(data_code)==v_furusato_gdlc_cd){setRegionFilterVisible(true);}
else{setRegionFilterVisible(false);}}
categoryClick(cd,type,this,e,getInitTriggerValue(isInitTrigger));});$(document).on('click',"#ul_category_nav li",function(){var index=$("#ul_category_nav li").index(this);categoryNavClick(index);});$(document).on("click","#ul_category_all input",function(e,isInitTrigger){if(setting.isAllPopupSubmit==true)return;var data_code=$(this).attr("data-code");var sep=data_code.split(':');var type=sep[0];var cd=sep[1];if(_debug)console.log('CLICK #ul_category_all input: type: '+type+', cd: '+cd);if(flag_hidden_region==true&&v_filter_displaypage!="FURUSATO_SRP"){if(getCategoryGDLC(data_code)==v_furusato_gdlc_cd){setRegionFilterVisible(true);}
else{setRegionFilterVisible(false);}}
categoryClick(cd,type,this,e,getInitTriggerValue(isInitTrigger));});$(document).on('click',"#ul_categoryall_nav li",function(){var index=$("#ul_categoryall_nav li").index(this);categoryNavClick(index);});$(document).on('click',"#ul_category_all .filterDetailList button.removeBtn",function(e){categoryNavClick(0);previewResult();});}
function initRegionEventBind(){$(document).on("click","#ul_region button",function(e,isInitTrigger){var data_code=$(this).attr("data-code");var sep=data_code.split(':');var type=sep[0];var cd=sep[1];regionClick(cd,type,this,e,getInitTriggerValue(isInitTrigger));});$(document).on('click',"#ul_region_nav li",function(){var index=$("#ul_region_nav li").index(this);regionNavClick(index);});$(document).on("click","#ul_region_all input",function(e,isInitTrigger){if(setting.isAllPopupSubmit==true)return;var data_code=$(this).attr("data-code");var sep=data_code.split(':');var type=sep[0];var cd=sep[1];if(_debug)console.log('CLICK #ul_region_all input: type: '+type+', cd: '+cd);regionClick(cd,type,this,e,getInitTriggerValue(isInitTrigger));});$(document).on('click',"#ul_regionall_nav li",function(){var index=$("#ul_regionall_nav li").index(this);regionNavClick(index);});$(document).on('click',"#ul_region_all .filterDetailList button.removeBtn",function(e){regionNavClick(0);previewResult();});}
function initBrandEventBind(){$(document).on("change","#ul_brand li input[type=\'checkbox\']",function(e,isInitTrigger){var cd=$(this).attr("data-code");brandClick(cd,this,e,getInitTriggerValue(isInitTrigger));});$(document).on("change","#ul_brandall li input[type=\'checkbox\']",function(e,isInitTrigger){if(setting.isAllPopupSubmit==true)return;previewResult();});}
function initBrandSubFilter(tabIdx){var brandtab_template="<li class=\"{className}\"><button type=\"button\" data-value=\"{name}\" data-brandtab=\"{type}\">{name}</button>";var render_html='';var html=brandtab_template.replace("{className}",'selected');html=html.replace(/\{name\}/g,"all");html=html.replace("{type}",tabIdx);render_html+=html;if(tabIdx==1){for(var i=0;i<default_brand_sort_abc_json.length;i++){html=brandtab_template.replace("{className}","");html=html.replace(/\{name\}/g,default_brand_sort_abc_json[i]);html=html.replace("{type}",tabIdx);render_html+=html;}}
else if(tabIdx==2){for(key in default_brand_sort_hira_json[0])
{html=brandtab_template.replace("{className}","");html=html.replace(/\{name\}/g,key);html=html.replace("{type}",tabIdx);render_html+=html;}}
$('#ul_brand_subfilter').html(render_html);$('#ul_brand_subfilter li button').off();$('#ul_brand_subfilter li button').click(function(e){var filter_name=e.target.innerText;var filter_value=(filter_name=='all'?'':filter_name);var type=e.target.getAttribute("data-brandtab");selectedBrandTab=type;selectedBrandTab_Keyword=filter_value;UpdateBrandList(type,filter_value);if(type=='1'||type=='2'){$('#ul_brand_subfilter li').removeClass('selected');var brandsubfilter_li=$('#ul_brand_subfilter li button[data-value=\''+filter_name+'\']').parent();if(brandsubfilter_li.hasClass('selected')==false){brandsubfilter_li.addClass('selected');}
$('#ul_brand_subfilterall li').removeClass('selected');var brandsubfilterall_li=$('#ul_brand_subfilterall li button[data-value=\''+filter_name+'\']').parent();if(brandsubfilterall_li.hasClass('selected')==false){brandsubfilterall_li.addClass('selected');}}});$('#ul_brand_subfilterall').html(render_html);$('#ul_brand_subfilterall li button').off();$('#ul_brand_subfilterall li button').click(function(e){var type=e.target.getAttribute("data-brandtab");var filter_name=e.target.innerText;var filter_value=(filter_name=='all'?'':filter_name);selectedBrandTab=type;selectedBrandTab_Keyword=filter_value;UpdateBrandList(type,filter_value);if(type=='1'||type=='2'){$('#ul_brand_subfilter li').removeClass('selected');var brandsubfilter_li=$('#ul_brand_subfilter li button[data-value=\''+filter_name+'\']').parent();if(brandsubfilter_li.hasClass('selected')==false){brandsubfilter_li.addClass('selected');}
$('#ul_brand_subfilterall li').removeClass('selected');var brandsubfilterall_li=$('#ul_brand_subfilterall li button[data-value=\''+filter_name+'\']').parent();if(brandsubfilterall_li.hasClass('selected')==false){brandsubfilterall_li.addClass('selected');}}});}
function initEventTrigger(){window.setTimeout(function(){if(_isEnableFilter(FilterTabID.category)){if(setting.category.category_view_depth>0){categoryNavClick(setting.category.category_view_depth);}
else{if(setting.category.gdlc_cd!=''||setting.category.gdmc_cd!=''||setting.category.gdsc_cd!=''){if(setting.category.gdsc_cd!=''){$('#ul_category button[data-code="S:'+setting.category.gdlc_cd+'"]').trigger('click',true);}
else if(setting.category.gdmc_cd!=''){$('#ul_category button[data-code="M:'+setting.category.gdmc_cd+'"]').trigger('click',true);}
else if(setting.category.gdlc_cd!=''){$('#ul_category button[data-code="L:'+setting.category.gdlc_cd+'"]').trigger('click',true);}
if(_debug)console.log('[initEventTrigger] category (gdlc: '+setting.category.gdlc_cd+', gdmc: '+setting.category.gdmc_cd+', gdsc: '+setting.category.gdsc_cd);}}}
if(_isEnableFilter(FilterTabID.region)){if(setting.region.region_large_cd!=''||setting.region.region_medium_cd!=''||setting.region.region_small_cd!=''){if(setting.region.region_small_cd!=''){$('#ul_region button[data-code="S:'+setting.region.region_small_cd+'"]').trigger('click',true);}
else if(setting.region.region_medium_cd!=''){$('#ul_region button[data-code="M:'+setting.region.region_medium_cd+'"]').trigger('click',true);}
else if(setting.region.region_large_cd!=''){$('#ul_region button[data-code="L:'+setting.region.region_large_cd+'"]').trigger('click',true);}
if(_debug)console.log('[initEventTrigger] region');}}
if(_isEnableFilter(FilterTabID.free_shipping)){if(setting.shipping.free){$("#filter_free_shipping").trigger("click",true);if(_debug)console.log('[initEventTrigger] freeshipping');}}
if(_isEnableFilter(FilterTabID.brand)){if(setting.brand_nos.length>0&&setting.brand_nos[0]!=""){setting.brand_nos.forEach(function(item,index,array){$('#ul_brandall input[data-code='+item+']').trigger("click",true);$('#ul_brand li input[data-code='+item+']').trigger("click",true);});if(_debug)console.log('[initEventTrigger] brand_nos : '+setting.brand_nos);}}
if(_isEnableFilter(FilterTabID.shipping_from)){setting.ship_from_nation_cds.forEach(function(item,index,array){$("#shipping_from_"+item).trigger("click",true);});}},100);}
function setCategoryFilter(dataCode){if(dataCode!=''){$('#ul_category button[data-code="'+dataCode+'"]').trigger('click',true);if(_debug)console.log('[setCategory] dataCode: '+dataCode);}}
function removeFilter(filtertab,dataCode){var selector='#filter_selectedlist button.removeBtn[data-filtertab='+filtertab+']';if(typeof dataCode=="undefined"&&dataCode!=''){$(selector).trigger('click',true);}
else if(dataCode!=''){$(selector).each(function(index,item){var code=$(item).attr('data-code');if(code==dataCode){$(item).trigger('click',true);}});}}
function setPromotionToggleFilterUI(isSelected){if($("#btn_promotion_toggle").hasClass("selected")){flag_toastmsg_show=true;selectFilterValue.param_promotion_yn="Y";$("#sp_toggle_text").text($("#btn_promotion_toggle").attr("data-title")+" ON");$("#sp_toggle_text").css("color",$("#sp_toggle_text").attr("data-oncolor"));$("#img_toggle_img").attr("src",$("#img_toggle_img").attr("data-onimg"));GA_Event_Call(v_filter_eventtag_category,v_filter_eventtag_action,"filter_megawari");}else{flag_toastmsg_show=false;selectFilterValue.param_promotion_yn="";$("#sp_toggle_text").text($("#btn_promotion_toggle").attr("data-title")+" OFF");$("#sp_toggle_text").css("color",$("#sp_toggle_text").attr("data-offcolor"));$("#img_toggle_img").attr("src",$("#img_toggle_img").attr("data-offimg"));}}
function setRegionFilterVisible(isShow){if(isShow){if($('#li_filter_region').css('display')=='none'){$('#li_filter_region').show();$('#btn_regionall_title').show();$('#div_regionall').show();}}
else{$('#li_filter_region').hide();$('#btn_regionall_title').hide();$('#div_regionall').hide();}}
function validate_InputPrice(input_begin,input_end,msg_res_id){if(_debug)console.log('call validate_InputPrice');var beginPrice=$(input_begin).val();var endPrice=$(input_end).val();if(beginPrice==''&&endPrice=='')return false;if(beginPrice!=''&&parseInt(beginPrice)<=0&&endPrice==''){$(input_begin).val('');$(input_begin).blur();alert(setting.getResource('Msg_validate_price_1_more'));return false;}
if(beginPrice=='0'){$(input_begin).val('');}
var ret=checkFilterPrice(beginPrice,endPrice);if(ret==-1){alert(setting.getResource(msg_res_id));var input_price=last_customPriceInputIdx==1?input_begin:input_end;$(input_price).val('');$(input_price).focus();return false;}
else{return true;}}
function checkFilterPrice(beginPrice,endPrice){beginPrice=parseInt(Util.safeNumber(beginPrice));if(endPrice=='')
endPrice=-1;else
endPrice=parseInt(Util.safeNumber(endPrice));if(_debug)console.log('beginPrice: '+beginPrice+', endPrice:'+endPrice);var ret=1;if(beginPrice==0&&endPrice==0)ret=0;else if(endPrice!=-1&&beginPrice>=endPrice)ret=-1;else
ret=1;return ret;}
function focusAndOpenKeyboard(el,timeout){if(!timeout){timeout=100;}
if(el){var __tempEl__=document.createElement('input');__tempEl__.style.position='absolute';__tempEl__.style.top=(el.offsetTop+7)+'px';__tempEl__.style.left=el.offsetLeft+'px';__tempEl__.style.height=0;__tempEl__.style.opacity=0;document.body.appendChild(__tempEl__);__tempEl__.focus();setTimeout(function(){document.body.removeChild(__tempEl__);el.focus();el.click();},timeout);}}
function getCategoryGDLC(dataCode){if(typeof dataCode=="undefined"||dataCode.trim()=='')
return'';var sep=dataCode.split(':');var _categoryType=sep[0];var _categoryCode=sep[1];var _gdlc_cd='';if(_categoryType=='L'){_gdlc_cd=_categoryCode;}
else if(_categoryType=='M'){var _gdmc_info=getCategoryInfo(_categoryCode);_gdlc_cd=_gdmc_info.ParentCategoryCode;}
else if(_categoryType=='S'){var _gdsc_info=getCategoryInfo(_categoryCode);var _gdmc_cd=_gdsc_info.ParentCategoryCode;var _gdmc_info=getCategoryInfo(_gdmc_cd);_gdlc_cd=_gdmc_info.ParentCategoryCode;}
return _gdlc_cd;}
function setCookieViewGoodsListType(gridview){if(typeof v_filter_usecookieviewtype!="undefined"&&v_filter_usecookieviewtype&&typeof v_filter_displaypage!="undefined"){var cookie_id=v_filter_displaypage;if(v_filter_displaypage=="FURUSATO_SRP")
cookie_id="SRP";Util.setCookie("viewgdlist_"+cookie_id,","+gridview);}};function getCookieViewGoodsListType(){if(typeof v_filter_usecookieviewtype!="undefined"&&v_filter_usecookieviewtype&&typeof v_filter_displaypage!="undefined"){var cookie_id=v_filter_displaypage;if(v_filter_displaypage=="FURUSATO_SRP")
cookie_id="SRP";return Util.getCookie("viewgdlist_"+cookie_id);}
else
return"";};function getSubCategoryList(category_cd){var category_infos=setting.datas.categories.filter(function(item,index,array){return item.ParentCategoryCode==category_cd});return category_infos;}
function getCategoryInfo(category_cd){var obj=setting.datas.categories.filter(function(item,index,array){return item.CategoryCode==category_cd});var parentObj=null;if(obj.length>0)
parentObj=obj[0];return parentObj;}
function getSubRegionList(category_cd){var region_infos=setting.datas.regions.filter(function(item,index,array){return item.ParentCategoryCode==category_cd});return region_infos;}
function getRegionInfo(category_cd){var obj=setting.datas.regions.filter(function(item,index,array){return item.CategoryCode==category_cd});var parentObj=null;if(obj.length>0)
parentObj=obj[0];return parentObj;}
function getBrandList(type,filter_keyword){if(_debug)console.log('getBrandList: type:'+type+', filter_keyword: '+filter_keyword);if(setting.datas.brands==null||setting.datas.brands.length<1)
return null;var datas=null;if(type==1){datas=setting.datas.brands.filter(function(item,index,array){if(filter_keyword==''){var pattern1=/[0-9]/;var pattern2=/[a-zA-Z]/;var pattern3=/[~!@#$%^&*()_+|<>?:{}]/;var str=item.brand_nm_en.substr(0,1);return pattern1.test(str)||pattern2.test(str)||pattern3.test(str);}
else{return item.brand_nm_en.toLowerCase().substr(0,1)==filter_keyword;}});datas.sort(function(a,b){var nameA=a.brand_nm_en.toLowerCase();var nameB=b.brand_nm_en.toLowerCase();if(nameA<nameB){return-1;}
if(nameA>nameB){return 1;}
return 0;});}
else if(type==2){var template_first_letter='';if(filter_keyword==''){for(letter in default_brand_sort_hira_json[0]){template_first_letter+=default_brand_sort_hira_json[0][letter];}}
else{template_first_letter=default_brand_sort_hira_json[0][filter_keyword];}
datas=setting.datas.brands.filter(x=>template_first_letter.indexOf(x.brand_reading.substr(0,1))>-1);datas.sort(function(a,b){var nameA=a.brand_reading;var nameB=b.brand_reading;if(nameA<nameB){return-1;}
if(nameA>nameB){return 1;}
return 0;});}
else if(type==9&&filter_keyword!=''){datas=setting.datas.brands.filter(function(item,index,array){return item.brand_nm.toLowerCase().indexOf(filter_keyword.toLowerCase())>-1||item.brand_reading.toLowerCase().indexOf(filter_keyword.toLowerCase())>-1?true:false;});if(_debug)console.log('Brand Search Result Count: '+(datas?datas.length:0));}
else{datas=setting.datas.brands;}
return datas;}
function getCategoryHtml(category_infos,type){if(typeof type==undefined)type=1;var template='';var ga_attributeTag='';if(type==1){template="<li><button type=\"button\" class=\"{className}\" {diabled} data-code=\"{data_code}\" data-value=\"{name}\" {ga_eventtag}>{name}</button></li>";if(v_filter_eventtagflag=='Y'){ga_attributeTag=UITrackingHelper.GetGA360HtmlAttribute(true,v_filter_eventtag_category,v_filter_eventtag_action,"filter_category");}}
else{template="<li>"+"    <input type=\"radio\" name=\"slidecategoryRadio\" id=\"slidecategoryRadiofilterAll{idx}\" class=\"{className}\" data-code=\"{data_code}\" data-value=\"{name}\">"+"    <label for=\"slidecategoryRadiofilterAll{idx}\">"+"    <span>{name}</span></label>"+"    <button type=\"button\" class=\"notFilterAct removeBtn\">Remove</button>"+"</li>";}
var html="";var category_html="";var total_cnt=category_infos.length;var page_cnt=parseInt(total_cnt/setting.visible_count.category)+(total_cnt%setting.visible_count.category==0?0:1);var selected_data_code=$(setting.selectedFilters_selector+'[data-filtertab='+FilterTabID.category+']').attr('data-code');if(type==2){if(flag_more_category==false||total_cnt<=setting.visible_count.category){$('#btn_categoryall_more').hide();}
else{$('#btn_categoryall_more').show();}}
for(k=0;k<page_cnt;k++){category_html+="<li"+(k==0?' class=\'selected\'':'')+(type==2&&k>0&&flag_more_category?" style=\"display: none;\"":"")+"><ul class=\"filterDetailList\">";for(i=0;i<setting.visible_count.category;i++){var idx=(setting.visible_count.category*k)+i;var categoryName='';var categoryCd='';var categoryType='';var className='';var disbled='';var data_code='';if(idx<total_cnt){var item=category_infos[idx];categoryName=item.CategoryName;categoryCd=item.CategoryCode;categoryType=item.CategoryType;className=item.CategoryType=='L'||item.CategoryType=='M'?'category':'category last';disbled='';data_code=item.CategoryType+':'+item.CategoryCode;if(data_code==selected_data_code){className+=' selected';}}
else if(type==1){className="hidden";disbled="disabled=\"disabled\"";categoryName="Hidden";}
else{break;}
html=template.replace(/\{name\}/g,categoryName);html=html.replace("{className}",className);html=html.replace("{diabled}",disbled);html=html.replace(/\{category_cd\}/g,categoryCd);html=html.replace(/\{category_type\}/g,categoryType);html=html.replace(/\{idx\}/g,idx);html=html.replace(/\{data_code\}/g,data_code);html=html.replace(/\{ga_eventtag\}/g,ga_attributeTag);category_html+=html;}
category_html+="</ul></li>";}
return category_html;}
function getRegionHtml(region_infos,type){if(typeof type==undefined)type=1;var template='';var ga_attributeTag='';if(type==1){template="<li><button type=\"button\" class=\"{className}\" {diabled} data-code=\"{data_code}\" data-value=\"{name}\" {ga_eventtag}>{name}</button></li>";if(v_filter_eventtagflag=='Y'){ga_attributeTag=UITrackingHelper.GetGA360HtmlAttribute(true,v_filter_eventtag_category,v_filter_eventtag_action,"filter_region");}}
else{template="<li>"+"    <input type=\"radio\" name=\"slideareaRadio\" id=\"slideareaRadiofilterAll{idx}\" class=\"{className}\" data-code=\"{data_code}\" data-value=\"{name}\">"+"    <label for=\"slideareaRadiofilterAll{idx}\">"+"    <span>{name}</span></label>"+"    <button type=\"button\" class=\"notFilterAct removeBtn\">Remove</button>"+"</li>";}
var html="";var category_html="";var total_cnt=region_infos.length;var page_cnt=parseInt(total_cnt/setting.visible_count.region)+(total_cnt%setting.visible_count.region==0?0:1);var selected_data_code=$(setting.selectedFilters_selector+'[data-filtertab='+FilterTabID.region+']').attr('data-code');if(type==2){if(flag_more_region==false||total_cnt<=setting.visible_count.region){$('#btn_regionall_more').hide();}
else{$('#btn_regionall_more').show();}}
for(k=0;k<page_cnt;k++){category_html+="<li"+(type==2&&k>0&&flag_more_region?" style=\"display: none;\"":"")+"><ul class=\"filterDetailList\">";for(i=0;i<setting.visible_count.region;i++){var idx=(setting.visible_count.region*k)+i;var categoryName='';var categoryCd='';var categoryType='';var className='';var disbled='';var data_code='';if(idx<total_cnt){var item=region_infos[idx];categoryName=item.CategoryName;categoryCd=item.CategoryCode;categoryType=item.CategoryType;className=item.CategoryType=='L'||item.CategoryType=='M'?'category':'category last';disbled='';data_code=item.CategoryType+':'+item.CategoryCode;if(data_code==selected_data_code){className+=' selected';}}
else if(type==1){className="hidden";disbled="disabled=\"disabled\"";categoryName="Hidden";}
else{break;}
html=template.replace(/\{name\}/g,categoryName);html=html.replace("{className}",className);html=html.replace("{diabled}",disbled);html=html.replace(/\{category_cd\}/g,categoryCd);html=html.replace(/\{category_type\}/g,categoryType);html=html.replace(/\{idx\}/g,idx);html=html.replace(/\{data_code\}/g,data_code);html=html.replace(/\{ga_eventtag\}/g,ga_attributeTag);category_html+=html;}
category_html+="</li></ul>";}
return category_html;}
function getBrandHtml(type,filter_letter,isAllPopup){if(_debug)console.log('getBrandHtml: type:'+type+', filter_letter: '+filter_letter+', isAllPopup: '+isAllPopup);var brandHtml='';var datas=getBrandList(type,filter_letter);if(datas!=null){var template;template="<li {li_className}><input type=\"checkbox\" id=\"{id}\" data-value=\"{brand_nm}\" data-code=\"{brand_no}\" class=\"{selected}\" {ga_eventtag}> ";template+=" <label for=\"{id}\"> ";template+="  <span>{brand_nm_title}</span> ";template+=" </label> ";template+="</li> ";var ga_attributeTag='';if(v_filter_eventtagflag=='Y'){ga_attributeTag=UITrackingHelper.GetGA360HtmlAttribute(true,v_filter_eventtag_category,v_filter_eventtag_action,"filter_brand");}
if(datas!=null&&datas.length>0){var count=datas.length>setting.visible_count.brand?setting.visible_count.brand:datas.length;for(var i=0;i<count;i++){var item=datas[i];var logo_img=item.logo_img.replace("http://","https://");var ctlid="brandCheckfilterMenu"+i;var selected=selectFilterValue.param_brand_nos.containItem(item.brand_no)?"selected":"";var brand_nm_title=(type==1?item.brand_nm_en:item.brand_nm);var li_className="";if(type==9&&filter_letter!=''){if(item.brand_nm.toLowerCase().indexOf(filter_letter.toLowerCase())>-1){var rex=new RegExp("(".concat(filter_letter,")"),"gim");brand_nm_title=brand_nm_title.replace(rex,(function(e,t){return"<strong>".concat(t,"</strong>")}));}}
var html='';if(isAllPopup==true){ctlid="brandCheckfilterAll"+i;li_className=(i>=setting.visible_count.brand_all&&flag_more_brand?" class=\"\hidden\"":"");}
var html=template.replace(/\{id\}/g,ctlid);html=html.replace(/\{brand_nm_title\}/g,brand_nm_title);html=html.replace(/\{brand_nm\}/g,item.brand_nm);html=html.replace(/\{brand_no\}/g,item.brand_no);html=html.replace(/\{logo_img\}/g,logo_img);html=html.replace("{li_className}",li_className);html=html.replace("{selected}",selected);html=html.replace(/\{ga_eventtag\}/g,ga_attributeTag);brandHtml+=html;}}
else{brandHtml="<li class=\"list_empty\"></li>";}}
return brandHtml;}
function UpdateCategoryUI(category_infos){window.setTimeout(function(){if(category_infos!=null&&category_infos.length>0){var category_html=getCategoryHtml(category_infos,1);$('#ul_category').html(category_html);$('#slidecategory .total').html(Math.ceil(category_infos.length/setting.visible_count.category));new qoo10_func.dg_slide().reInit('#slidecategory.slide_wrap');if(_isShowAllPopup()==false&&flag_reset==false)
qoo10_func._slideAfterFunc();var category_html2=getCategoryHtml(category_infos,2);$('#ul_category_all').html(category_html2);if($('#ul_category_all li:hidden').length>0){$('#btn_categoryall_more').show();}
else{$('#btn_categoryall_more').hide();}}},0);}
function UpdateRegionUI(region_infos){window.setTimeout(function(){if(region_infos!=null&&region_infos.length>0){var region_html=getRegionHtml(region_infos,1);$('#ul_region').html(region_html);$('#slidearea .total').html(Math.ceil(region_infos.length/setting.visible_count.region));new qoo10_func.dg_slide().reInit('#slidearea.slide_wrap');if(_isShowAllPopup()==false&&flag_reset==false)
qoo10_func._slideAfterFunc();var region_html2=getRegionHtml(region_infos,2);$('#ul_region_all').html(region_html2);if($('#ul_region_all li:hidden').length>0){$('#btn_regionall_more').show();}
else{$('#btn_regionall_more').hide();}
$('#ul_region button.selected').removeClass("selected");$('#ul_region_all input.selected').removeClass("selected");}},0);}
function UpdateBrandList(type,filter_letter,asyncTime){if(typeof asyncTime=="undefined")
asyncTime=0;if(_debug)console.log('UpdateBrandList: type:'+type+', filter_letter: '+filter_letter);if(_handle_BrandUpdate!=null){window.clearTimeout(_handle_BrandUpdate);_handle_BrandUpdate=null;}
_handle_BrandUpdate=window.setTimeout(function(){var brandHtml='';brandHtml=getBrandHtml(type,filter_letter,false);$('#ul_brand').html(brandHtml);brandHtml=getBrandHtml(type,filter_letter,true);$('#ul_brandall').html(brandHtml);if($('#ul_brandall li.hidden').length>0){$('#btn_brandall_more').show();}
else{$('#btn_brandall_more').hide();}
_handle_BrandUpdate=null;},asyncTime);}
function categoryNavClick(depth){if(_debug)console.log("categoryNavClick: "+depth);if(setting.category.category_view_depth>0)
depth=setting.category.category_view_depth;var _parent_category_cd=depth==0?'':depth==1?selectFilterValue.param_gdlc_cd:selectFilterValue.param_gdmc_cd;$("#ul_category_nav li:gt("+depth+")").remove();$("#ul_category_nav li:eq("+depth+")").html($("#ul_category_nav li:eq("+depth+") button").html());$("#ul_categoryall_nav li:gt("+depth+")").remove();$("#ul_categoryall_nav li:eq("+depth+")").html($("#ul_categoryall_nav li:eq("+depth+") button").html());var category_infos=getSubCategoryList(_parent_category_cd);UpdateCategoryUI(category_infos);}
function categoryClick(category_cd,category_kind,obj,e,isInitTrigger){var $obj=$(obj);var isSeleted=$obj.hasClass('selected');if(isSeleted)return;if(_isShowAllPopup())
previewResult();else{if(!isInitTrigger)
apply();}
var category_infos=getSubCategoryList(category_cd);UpdateCategoryUI(category_infos);if(!isInitTrigger)
setting.callback.categoryClick(cate_tree,category_cd,category_kind,isSeleted,obj,selectFilterValue,e);}
function regionNavClick(depth){if(_debug)console.log("regionNavClick: "+depth);var _parent_cd=depth==0?'':depth==1?selectFilterValue.param_region_large_cd:selectFilterValue.param_region_medium_cd;$("#ul_region_nav li:gt("+depth+")").remove();$("#ul_region_nav li:eq("+depth+")").html($("#ul_region_nav li:eq("+depth+") button").html());$("#ul_regionall_nav li:gt("+depth+")").remove();$("#ul_regionall_nav li:eq("+depth+")").html($("#ul_regionall_nav li:eq("+depth+") button").html());var region_infos=getSubRegionList(_parent_cd);UpdateRegionUI(region_infos);}
function regionClick(category_cd,category_kind,obj,e,isInitTrigger){var $obj=$(obj);var isSeleted=$obj.hasClass('selected');if(isSeleted)return;if(_isShowAllPopup())
previewResult();else{if(!isInitTrigger)
apply();}
var region_infos=getSubRegionList(category_cd);UpdateRegionUI(region_infos);if(!isInitTrigger)
setting.callback.regionClick(cate_tree,category_cd,category_kind,isSeleted,obj,selectFilterValue,e);}
function shippingFromClick(shipping_from_cd,obj,e,isInitTrigger){var selected=!_isSelected(obj);if(!isInitTrigger)
apply();if(!isInitTrigger)
setting.callback.shippingFromClick(shipping_from_tree,selectFilterValue.param_ship_from_nation_cds,shipping_from_cd,selected,obj,e);}
function brandClick(brand_no,obj,e,isInitTrigger){var selected=_isSelected(obj);if(!isInitTrigger){if(_isShowAllPopup())
previewResult();else
apply(selected?true:false);}
if(!isInitTrigger)
setting.callback.brandClick(brand_tree,selectFilterValue.param_brand_nos,brand_no,selected,obj,e);}
return{setOptions:setOptions,getFilterParameter:getFilterParameter,getUseFilter:function(){var filter_count=getFilterCount();return filter_count;},selectFilterValue:selectFilterValue,setTotalCount:function(cnt){filtered_item_count=cnt;if(_debug)console.log('[setTotalCount: '+filtered_item_count+']');setPreviewSearchResult(filtered_item_count);},getTotalCount:function(){return filtered_item_count;},setFilterClearSection:function(){if(filtered_item_count==0){$("#div_filter_search_no_data").show();if($("#div_item_list").length>0&&$("#div_item_list").children(".no_result").length>0&&!$("#div_item_list").hasClass("hide")){$("#div_item_list").addClass("hide");$("#div_item_list").hide();}}
else{$("#div_filter_search_no_data").hide();if($("#div_item_list").length>0&&$("#div_item_list").hasClass("hide")){$("#div_item_list").removeClass("hide");$("#div_item_list").show();}}},selectCategory:function(cd){var category_infos=setting.datas.categories.filter(function(item,index,array){return item.CategoryCode==cd;});if(category_infos!=null&&category_infos.length>0){var dataCode=category_infos[0].CategoryType+':'+category_infos[0].CategoryCode;setCategoryFilter(dataCode);}},clearCategory:function(){setting.category.gdlc_cd="";setting.category.gdmc_cd="";setting.category.gdsc_cd="";setting.settingToParams();},apply:apply,reset:reset,setPreviewSearchResult:setPreviewSearchResult,setCategoryFilter:setCategoryFilter,removeFilter:removeFilter,hideFilterMenu:hideFilterMenu,printLog:function(type){if(type==1){var params="";params="keyword="+selectFilterValue.param_search_keyword;params+="&group_code="+selectFilterValue.param_group_cd;params+="&gdlc_cd="+selectFilterValue.param_gdlc_cd;params+="&gdmc_cd="+selectFilterValue.param_gdmc_cd;params+="&gdsc_cd="+selectFilterValue.param_gdsc_cd;params+="&region_large_cd="+selectFilterValue.param_region_large_cd;params+="&region_medium_cd="+selectFilterValue.param_region_medium_cd;params+="&region_small_cd="+selectFilterValue.param_region_small_cd;params+="&brand_no="+selectFilterValue.param_brand_nos.join(",");params+="&free_shipping_search_yn="+selectFilterValue.param_free_shipping_search_yn;params+="&official_shop="+selectFilterValue.param_official_shop;params+="&promotion_yn="+selectFilterValue.param_promotion_yn;params+="&min_price="+selectFilterValue.param_price_range.currentMin;params+="&max_price="+selectFilterValue.param_price_range.currentMax;params+="&ship_from_nation_cd="+selectFilterValue.param_ship_from_nation_cds.join(",");params+="&additional_keyword="+selectFilterValue.param_search_in_result.join(" ");params+="&review_score="+selectFilterValue.param_review_score;if(_debug)console.log('[param]\n'+params.replace(/\&/g,'\t\n\&'));}},ShowFilterLoading:function(){qoo10_func.filterLoading();},HideFilterLoading:function(){qoo10_func.filterLoadingClose();},ToastResultMsg:function(total_cnt,time){if(flag_toastmsg_show==false)return;if(typeof time=="undefined")time=1500;var msg_result=setting.getResource("Msg_SearchResult_Count");msg_result=msg_result.replace('{0}',Util.getNumberFormat(total_cnt));qoo10_func.filterText(msg_result,time);},HideToastResultMsg:function(){qoo10_func.filterTextClose();},SetToastResultMsgEnable:function(isEnable){flag_toastmsg_show=false;}};}
var MobileSearchUtil={processSearchResult:function(){if(MobileSearchItemList.total_item_count==0){$("#div_item_list > div.list_view_section").hide();$("#div_item_list").show();}else{$("#div_item_list > div.list_view_section").show();$("#div_item_list").show();}
if(MobileSearchItemList.change_sort_type){MobileSearchItemList.change_sort_type=false;}
if(typeof mobileFilterUI!="undefined")
mobileFilterUI.setFilterClearSection();}}