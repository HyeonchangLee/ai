// (c)2013 Giosis Group

var gtouch=null;$(document).ready(function(){gtouch=new function(){this.dragx=null,this.dragy=null;this.dragging=false,this.resizing=false;this.dragx_max=0;this.moving=true;this.first_ui_position=[];this.start_position=[];this.move_position=[];this.last_position=[];this.move_start=true;this.scale_value=this.last_scale=1.0;if(GMKT.DeviceInfo.Kind=="Desktop"){this.xy_position_define=1;}else if(GMKT.DeviceInfo.Kind=="Tablet"){this.xy_position_define=5;}else{this.xy_position_define=5;};this.speed=[0,0];this.property="";this.transitionEnd="";this.styleProperty="";if(Public.browser.mozilla){this.property="-moz-";this.transitionEnd="transitionend";this.styleProperty="Moz";}else if(Public.browser.safari){this.property="-webkit-";this.transitionEnd="webkitTransitionEnd";this.styleProperty="webkit";}else if(Public.browser.opera){this.property="-o-";this.transitionEnd="oTransitionEnd";this.styleProperty="O";}else if(Public.browser.msie){this.property="-ms-";this.transitionEnd="msTransitionEnd";}else if(window.navigator&&window.navigator.userAgent&&window.navigator.userAgent.toLowerCase().indexOf('qtalk')>0){this.property="-webkit-";this.transitionEnd="webkitTransitionEnd";this.styleProperty="webkit";};this.translate=function(target,x,y,duration,callback,eventdelete){this.last_position.x=x;this.last_position.y=y;var id=target.attr("id");$get(id).style[this.styleProperty+"Transform"]="translate3d("+x+"px, "+y+"px, 0px)";if(duration!=undefined&&duration!=""){$get(id).style[this.styleProperty+"TransitionDuration"]=duration;target.bind(this.transitionEnd,function(){target.unbind(gtouch.transitionEnd);if(typeof(callback)=='function'){callback();};if(eventdelete!=false){$get(target.attr("id")).style[gtouch.styleProperty+"Transform"]="translate3d(0px, 0px, 0px)";};$get(target.attr("id")).style[gtouch.styleProperty+"Transition"]=null;});}else{if(typeof(callback)=='function'){callback();};};};this.scale=function(target,scale,scale_child,max,min){var obj=target;if(scale_child!=""){obj=target.find(scale_child);};this.scale_value=scale*this.last_scale;if(max==undefined){max=4.0;};if(min==undefined){min=0.5;};if(this.scale_value<0.5){this.scale_value=min;};if(this.scale_value>max){this.scale_value=max;};obj.css(this.property+"transform","scale("+this.scale_value+")");};this.getTranslateX=function(obj){return parseInt(this.matrixToArray(obj.css(this.property+"transform"))[4]);};this.getTranslateY=function(obj){return parseInt(this.matrixToArray(obj.css(this.property+"transform"))[5]);};this.matrixToArray=function(matrix){return matrix.replace("matrix(","").replace(")","").split(",");};};jQuery.fn.touch=function(settings){settings=jQuery.extend({dragx:false,dragx_max:0,dragy:false,scale:false,scale_max:4.0,scale_min:0.5,scale_child:"",drag_child:"li",prev:undefined,next:undefined},settings);var opts=[];opts=$.extend({},$.fn.touch.defaults,settings);if(MobileUtil.isApp()&&settings.prev!=undefined&&settings.next!=undefined){$(this).parent().addClass("cm_slide_area");$(this).after("<div class=\"cm_slide_ctrl\"><a role=\"button\" class=\"arr_prv\" onclick=\""+settings.prev+"\">Previous</a><a role=\"button\" class=\"arr_nxt\" onclick=\""+settings.next()+"\">Next</a></div>");};this.each(function(){this.opts=opts;if(opts.scale){this.ongesturestart=gesturestart;this.ongesturechange=gesturechange;this.ongestureend=gestureend;};if(opts.dragx||opts.dragy){this.ontouchstart=touchstart;this.ontouchmove=touchmove;this.ontouchend=touchend;$get(this.id).style[gtouch.styleProperty+"Transform"]="translate3d(0px, 0px, 0px)";$(this).find(opts.drag_child).each(function(){if($get(this.id)){$get(this.id).style[gtouch.styleProperty+"Transform"]="translate3d(0px, 0px, 0px)";};});};});};});var __moving_time=0;var __dragging_time;function touchstart(e){if($get(this.id).style[gtouch.styleProperty+"Transition"]==""){$get(this.id).style[gtouch.styleProperty+"TransitionProperty"]="all";$get(this.id).style[gtouch.styleProperty+"TransitionTimingFunction"]="ease-out";$get(this.id).style[gtouch.styleProperty+"TransitionDelay"]="0s";};gtouch.dragx=this.opts.dragx;gtouch.dragy=this.opts.dragy;if(this.opts.dragx_max!=undefined){gtouch.dragx_max=this.opts.dragx_max;};gtouch.move_start=true;var elem;if(e.changedTouches&&e.changedTouches.length>0){elem=e.changedTouches[0];}else{elem=e;};clearInterval(__dragging_time);__moving_time=0;__dragging_time=setInterval(function(){__moving_time+=0.001;},1);gtouch.move_position.left=gtouch.move_position.top=0;gtouch.start_position.left=elem.clientX;gtouch.start_position.top=elem.clientY;var moving=(this.opts.moving!=undefined?this.opts.moving:gtouch.moving);if(moving){gtouch.first_ui_position.left=gtouch.getTranslateX($('#'+this.id));gtouch.first_ui_position.top=gtouch.getTranslateY($('#'+this.id));};gtouch.speed.x=gtouch.speed.y=0;if(!gtouch.dragging&&!gtouch.resizing){gtouch.dragging=true;};if(typeof(this.opts.start)=='function'){this.opts.start($('#'+this.id),gtouch);};if(window.giosis&&window.giosis.setEnablePageScroll){window.giosis.setEnablePageScroll('F');};};function touchmove(e){var elem;if(e.changedTouches&&e.changedTouches.length>0){elem=e.changedTouches[0];}else{elem=e;};gtouch.move_position.left=elem.clientX-gtouch.start_position.left;gtouch.move_position.top=elem.clientY-gtouch.start_position.top;if(gtouch.dragging&&!gtouch.resizing){if(gtouch.dragx_max>0&&(gtouch.move_position.left>gtouch.dragx_max||gtouch.move_position.left<(-1*gtouch.dragx_max))){this.touchend(e);};if(gtouch.move_start&&gtouch.dragx&&!gtouch.dragy&&Math.abs(gtouch.move_position.left)<gtouch.xy_position_define){gtouch.dragx=false;};if(gtouch.move_start&&gtouch.dragy&&!gtouch.dragx&&Math.abs(gtouch.move_position.top)<gtouch.xy_position_define){gtouch.dragy=false;};if(!gtouch.dragx){gtouch.move_position.left=0;};if(!gtouch.dragy){gtouch.move_position.top=0;};gtouch.speed.x=gtouch.move_position.left/__moving_time;gtouch.speed.y=gtouch.move_position.top/__moving_time;var translate_x=gtouch.first_ui_position.left+gtouch.move_position.left;var translate_y=gtouch.first_ui_position.top+gtouch.move_position.top;if(!gtouch.resizing&&(gtouch.dragx||gtouch.dragy)){e.preventDefault();gtouch.translate($('#'+this.id),translate_x,translate_y);};if(typeof(this.opts.move)=='function'){this.opts.move($('#'+this.id),gtouch);};};gtouch.move_start=false;};function touchend(e){var elem;if(e.changedTouches&&e.changedTouches.length>0){elem=e.changedTouches[0];}else{elem=e;};clearInterval(__dragging_time);if(gtouch.dragging&&!gtouch.resizing){gtouch.move_position.left=elem.clientX-gtouch.start_position.left;gtouch.move_position.top=elem.clientY-gtouch.start_position.top;gtouch.speed.x=gtouch.move_position.left/__moving_time;gtouch.speed.y=gtouch.move_position.top/__moving_time;gtouch.dragging=false;if(typeof(this.opts.stop)=='function'){this.opts.stop($('#'+this.id),gtouch);};};if(window.giosis&&window.giosis.setEnablePageScroll){window.giosis.setEnablePageScroll('T');};};function gesturestart(e){if(gtouch.move_position.left==0&&gtouch.move_position.top==0&&this.opts.scale){gtouch.resizing=true;if(typeof(this.opts.gstart)=='function'){this.opts.gstart($("#"+this.id));};};};function gesturechange(e){if(gtouch.resizing){e.preventDefault();gtouch.scale($('#'+this.id),e.scale,this.opts.scale_child,this.opts.scale_max,this.opts.scale_min);if(typeof(this.opts.gmove)=='function'){this.opts.gmove($("#"+this.id));};};};function gestureend(e){gtouch.last_scale=gtouch.scale_value;setTimeout(function(){gtouch.resizing=false;},100);if(typeof(this.opts.gstop)=='function'){this.opts.gstop($("#"+this.id));};};